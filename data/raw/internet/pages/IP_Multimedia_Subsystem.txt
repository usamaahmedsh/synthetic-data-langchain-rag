The IP Multimedia Subsystem or IP Multimedia Core Network Subsystem (IMS) is a standardized architectural framework for delivering IP-based multimedia services. Historically, mobile phones have provided voice call services over a circuit-switched network, rather than over an IP-based packet-switched network. Various VoIP technologies are available on smartphones; IMS offers a standardized protocol across different vendors.
IMS was originally designed by the wireless standards body 3rd Generation Partnership Project (3GPP), as a part of the vision for evolving mobile networks beyond GSM. Its original formulation (3GPP Rel-5) represented an approach for delivering Internet services over GPRS.  This vision was later updated by 3GPP, 3GPP2 and ETSI TISPAN by requiring support of networks other than GPRS, such as Wireless LAN, CDMA2000 and fixed lines.
IMS uses IETF protocols wherever possible, e.g., the Session Initiation Protocol (SIP). According to the 3GPP, IMS is not intended to standardize applications, but rather to aid the access of multimedia and voice applications from wireless and wireline terminals, i.e., to create a form of fixed-mobile convergence (FMC). This is done by having a horizontal control layer that isolates the access network from the service layer. From a logical architecture perspective, services need not have their own control functions, as the control layer is a common horizontal layer. However, in implementation this does not necessarily map into greater reduced cost and complexity.
Alternative and overlapping technologies for access and provisioning of services across wired and wireless networks include combinations of Generic Access Network, softswitches and "naked" SIP.
Since it is becoming increasingly easier to access content and contacts using mechanisms outside the control of traditional wireless/fixed operators, the interest of IMS is being challenged.
Examples of global standards based on IMS are MMTel which is the basis for Voice over LTE (VoLTE), Wi-Fi Calling (VoWIFI), Video over LTE (ViLTE), SMS/MMS over WiFi and LTE, Unstructured Supplementary Service Data (USSD) over LTE, and Rich Communication Services (RCS), which is also known as joyn or Advanced Messaging, and now RCS is operator's implementation. RCS also further added Presence/EAB (enhanced address book) functionality.


== History ==
IMS was defined by an industry forum called 3G.IP, formed in 1999. 3G.IP developed the initial IMS architecture, which was brought to the 3rd Generation Partnership Project (3GPP), as part of their standardization work for 3G mobile phone systems in UMTS networks. It first appeared in Release 5 (evolution from 2G to 3G networks), when SIP-based multimedia was added. Support for the older GSM and GPRS networks was also provided.
3GPP2 (a different organization from 3GPP) based their CDMA2000 Multimedia Domain (MMD) on 3GPP IMS, adding support for CDMA2000.
3GPP release 6 added interworking with WLAN, inter-operability between IMS using different IP-connectivity networks, routing group identities, multiple registration and forking, presence, speech recognition and speech-enabled services (Push to talk).
3GPP release 7 added support for fixed networks by working together with TISPAN release R1.1, the function of AGCF (access gateway control function) and PES (PSTN emulation service) are introduced to the wire-line network for the sake of inheritance of services which can be provided in PSTN network. AGCF works as a bridge interconnecting the IMS networks and the Megaco/H.248 networks. Megaco/H.248 networks offers the possibility to connect terminals of the old legacy networks to the new generation of networks based on IP networks. AGCF acts a SIP User agent towards the IMS and performs the role of P-CSCF. SIP User Agent functionality is included in the AGCF, and not on the customer device but in the network itself. Also added voice call continuity between circuit switching and packet switching domain (VCC), fixed broadband connection to the IMS, interworking with non-IMS networks, policy and charging control (PCC), emergency sessions. It also added SMS over IP.
3GPP release 8 added support for LTE / SAE, multimedia session continuity, enhanced emergency sessions, SMS over SGs and IMS centralized services.
3GPP release 9 added support for IMS emergency calls over GPRS and EPS, enhancements to multimedia telephony, IMS media plane security, enhancements to services centralization and continuity.
3GPP release 10 added support for inter device transfer, enhancements to the single radio voice call continuity (SRVCC), enhancements to IMS emergency sessions.
3GPP release 11 added USSD simulation service, network-provided location information for IMS, SMS submit and delivery without MSISDN in IMS, and overload control.
Some operators opposed IMS because it was seen as complex and expensive.
In response, a cut-down version of IMS—enough of IMS to support voice and SMS over the LTE network—was defined and standardized in 2010 as Voice over LTE (VoLTE).


== Architecture ==

Each of the functions in the diagram is explained below.
The IP multimedia core network subsystem is a collection of different functions, linked by standardized interfaces, which grouped form one IMS administrative network. A function is not a node (hardware box): An implementer is free to combine two functions in one node, or to split a single function into two or more nodes. Each node can also be present multiple times in a single network, for dimensioning, load balancing or organizational issues.


=== Access network ===
The user can connect to IMS in various ways, most of which use the standard IP. IMS terminals (such as mobile phones, personal digital assistants (PDAs) and computers) can register directly on IMS, even when they are roaming in another network or country (the visited network). The only requirement is that they can use IP and run SIP user agents. Fixed access (e.g., digital subscriber line (DSL), cable modems, Ethernet, FTTx), mobile access (e.g. 5G NR, LTE, W-CDMA, CDMA2000, GSM, GPRS) and wireless access (e.g., WLAN, WiMAX) are all supported. Other phone systems like plain old telephone service (POTS—the old analogue telephones), H.323 and non IMS-compatible systems, are supported through gateways.


=== Core network ===
HSS – Home subscriber server:
The home subscriber server (HSS), or user profile server function (UPSF), is a master user database that supports the IMS network entities that actually handle calls. It contains the subscription-related information (subscriber profiles), performs authentication and authorization of the user, and can provide information about the subscriber's location and IP information. It is similar to the GSM home location register (HLR) and Authentication centre (AuC).
A subscriber location function (SLF) is needed to map user addresses when multiple HSSs are used.
User identities:
Various identities may be associated with IMS: IP multimedia private identity (IMPI), IP multimedia public identity (IMPU), globally routable user agent URI (GRUU), wildcarded public user identity. Both IMPI and IMPU are not phone numbers or other series of digits, but uniform resource identifier (URIs), that can be digits (a Tel URI, such as tel:+1-555-123-4567) or alphanumeric identifiers (a SIP URI, such as sip:john.doe@example.com ).
IP Multimedia Private Identity:
The IP Multimedia Private Identity (IMPI) is a unique permanently allocated global identity assigned by the home network operator. It has the form of a Network Access Identifier(NAI) i.e. user.name@domain, and is used, for example, for Registration, Authorization, Administration, and Accounting purposes.  Every IMS user shall have one IMPI.
IP Multimedia Public Identity:
The IP Multimedia Public Identity (IMPU) is used by any user for requesting communications to other users (e.g. this might be included on a business card). Also known as Address of Record (AOR). There can be multiple IMPU per IMPI. The IMPU can also be shared with another phone, so that both can be reached with the same identity (for example, a single phone-number for an entire family).
Globally Routable User Agent URI:
Globally Routable User Agent URI (GRUU) is an identity that identifies a unique combination of IMPU and UE instance. 
There are two types of GRUU: Public-GRUU (P-GRUU) and Temporary GRUU (T-GRUU). 

P-GRUU reveal the IMPU and are very long lived.
T-GRUU do not reveal the IMPU and are valid until the contact is explicitly de-registered or the current registration expires
Wildcarded Public User Identity:
A wildcarded Public User Identity expresses a set of IMPU grouped together.
The HSS subscriber database contains the IMPU, IMPI, IMSI, MSISDN, subscriber service profiles, service triggers, and other information.


==== Call Session Control Function (CSCF) ====
Several roles of SIP servers or proxies, collectively called Call Session Control Function (CSCF), are used to process SIP signaling packets in the IMS.

A Proxy-CSCF (P-CSCF) is a SIP proxy that is the first point of contact for the IMS terminal. It can be located either in the visited network (in full IMS networks) or in the home network (when the visited network is not IMS compliant yet). Some networks may use a Session Border Controller (SBC) for this function. The P-CSCF is at its core a specialized SBC for the User–network interface which not only protects the network, but also the IMS terminal. The use of an additional SBC between the IMS terminal and the P-CSCF is unnecessary and infeasible due to the signaling being encrypted on this leg. The terminal discovers its P-CSCF with either DHCP, or it may be configured (e.g. during initial provisioning or via a 3GPP IMS Management Object (MO)) or in the ISIM or assigned in the PDP Context (in General Packet Radio Service (GPRS)).
It is assigned to an IMS terminal before registration, and does not change for the duration of the registration.
It sits on the path of all signaling, and can inspect every signal; the IMS terminal must ignore any other unencrypted signaling.
It provides subscriber authentication and may establish an IPsec or TLS security association with the IMS terminal. This prevents spoofing attacks and replay attacks and protects the privacy of the subscriber.
It inspects the signaling and ensures that the IMS terminals do not misbehave (e.g. change normal signaling routes, disobey home network's routing policy).
It can compress and decompress SIP messages using SigComp, which reduces the round-trip over slow radio links.
It may include a Policy Decision Function (PDF), which authorizes media plane resources e.g., quality of service (QoS) over the media plane. It is used for policy control, bandwidth management, etc. The PDF can also be a separate function.
It also generates charging records.
An Interrogating-CSCF (I-CSCF) is another SIP function located at the edge of an administrative domain. Its IP address is published in the Domain Name System (DNS) of the domain (using NAPTR and SRV type of DNS records), so that remote servers can find it, and use it as a forwarding point (e.g., registering) for SIP packets to this domain.
it queries the HSS to retrieve the address of the S-CSCF and assign it to a user performing SIP registration
it also forwards SIP request or response to the S-CSCF
Up to Release 6 it can also be used to hide the internal network from the outside world (encrypting parts of the SIP message), in which case it's called a Topology Hiding Inter-network Gateway (THIG). From Release 7 onwards this "entry point" function is removed from the I-CSCF and is now part of the Interconnection Border Control Function (IBCF). The IBCF is used as gateway to external networks, and provides NAT and firewall functions (pinholing). The IBCF is a session border controller specialized for the network-to-network interface (NNI).
A Serving-CSCF (S-CSCF) is the central node of the signaling plane. It is a SIP server, but performs session control too. It is always located in the home network. It uses Diameter Cx and Dx interfaces to the HSS to download user profiles and upload user-to-S-CSCF associations (the user profile is only cached locally for processing reasons and is not changed). All necessary subscriber profile information is loaded from the HSS.
it handles SIP registrations, which allows it to bind the user location (e.g., the IP address of the terminal) and the SIP address
it sits on the path of all signaling messages of the locally registered users, and can inspect every message
it decides to which application server(s) the SIP message will be forwarded, in order to provide their services
it provides routing services, typically using Electronic Numbering (ENUM) lookups
it enforces the policy of the network operator
there can be multiple S-CSCFs in the network for load distribution and high availability reasons. It's the HSS that assigns the S-CSCF to a user, when it's queried by the I-CSCF. There are multiple options for this purpose, including a mandatory/optional capabilities to be matched between subscribers and S-CSCFs.


==== Application servers ====

SIP Application servers (AS) host and execute services, and interface with the S-CSCF using SIP. An example of an application server that is being developed in 3GPP is the Voice call continuity Function (VCC Server). Depending on the actual service, the AS can operate in SIP proxy mode, SIP UA (user agent) mode or SIP B2BUA mode. An AS can be located in the home network or in an external third-party network. If located in the home network, it can query the HSS with the Diameter Sh or Si interfaces (for a SIP-AS).

SIP AS: Host and execute IMS specific services
IP Multimedia Service Switching Function (IM-SSF): Interfaces SIP to CAP to communicate with CAMEL Application Servers
OSA service capability server (OSA SCS): Interfaces SIP to the OSA framework;


===== Functional model =====
The AS-ILCM (Application Server - Incoming Leg Control Model) and AS-OLCM (Application Server - Outgoing Leg Control Model) store transaction state, and may optionally store session state depending on the specific service being executed. 
The AS-ILCM interfaces to the S-CSCF (ILCM) for an incoming leg and the AS-OLCM interfaces to the S-CSCF (OLCM) for an outgoing leg.
Application Logic provides the service(s) and interacts between the AS-ILCM and AS-OLCM.


===== Public Service Identity =====
Public Service Identities (PSI) are identities that identify services, which are hosted by application servers. As user identities, PSI takes the form of either a SIP or Tel URI. PSIs are stored in the HSS either as a distinct PSI or as a wildcarded PSI:

a distinct PSI contains the PSI that is used in routing
a wildcarded PSI represents a collection of PSIs.


==== Media servers ====
The Media Resource Function (MRF) provides media related functions such as media manipulation (e.g. voice stream mixing) and playing of tones and announcements.
Each MRF is further divided into a media resource function controller (MRFC) and a media resource function processor (MRFP).

The MRFC  is a signalling plane node that interprets information coming from an AS and S-CSCF to control the MRFP
The MRFP is a media plane node used to mix, source or process media streams. It can also manage access right to shared resources.
The Media Resource Broker (MRB) is a functional entity that is responsible for both collection of appropriate published MRF information and supplying of appropriate MRF information to consuming entities such as the AS. MRB can be used in two modes:

Query mode: AS queries the MRB for media and sets up the call using the response of MRB
In-Line Mode: AS sends a SIP INVITE to the MRB. The MRB sets up the call


==== Breakout gateway ====
A Breakout Gateway Control Function (BGCF) is a SIP proxy which processes requests for routing from an S-CSCF when  the S-CSCF has determined that the session cannot be routed using DNS or ENUM/DNS. It includes routing functionality based on telephone numbers.


==== PSTN gateways ====
A PSTN/CS gateway interfaces with PSTN circuit switched (CS) networks. For signalling, CS networks use ISDN User Part (ISUP) (or BICC) over Message Transfer Part (MTP), while IMS uses SIP over IP. For media, CS networks use Pulse-code modulation (PCM), while IMS uses Real-time Transport Protocol (RTP).

A signalling gateway (SGW) interfaces with the signalling plane of the CS. It transforms lower layer protocols as Stream Control Transmission Protocol (SCTP, an IP protocol) into Message Transfer Part (MTP, a Signalling System 7 (SS7) protocol), to pass ISDN User Part (ISUP) from the MGCF to the CS network. The SGW does call control protocol conversion between SIP and ISUP/BICC under the control of the MGCF.
A media gateway controller function (MGCF) is a SIP endpoint that interfaces with the SGW over SCTP. It also controls the resources in a Media Gateway (MGW) across an H.248 interface.
A media gateway (MGW) interfaces with the media plane of the CS network, by converting between RTP and PCM. It can also transcode when the codecs don't match (e.g., IMS might use AMR, PSTN might use G.711).


==== Media resources ====
Media Resources are those components that operate on the media plane and are under the control of IMS core functions. Specifically, Media Server (MS) and Media gateway (MGW)


=== NGN interconnection ===
There are two types of next-generation networking interconnection:

Service-oriented interconnection (SoIx): The physical and logical linking of NGN domains that allows carriers and service providers to offer services over NGN (i.e., IMS and PES) platforms with control, signalling (i.e., session based), which provides defined levels of interoperability. For instance, this is the case of "carrier grade" voice and/or multimedia services over IP interconnection. "Defined levels of interoperability" are dependent upon the service or the QoS or the Security, etc.
Connectivity-oriented interconnection (CoIx): The physical and logical linking of carriers and service providers based on simple IP connectivity irrespective of the levels of interoperability. For example, an IP interconnection of this type is not aware of the specific end to end service and, as a consequence, service specific network performance, QoS and security requirements are not necessarily assured. This definition does not exclude that some services may provide a defined level of interoperability. However, only SoIx fully satisfies NGN interoperability requirements.
An NGN interconnection mode can be direct or indirect. Direct interconnection refers to the interconnection between two network domains without any intermediate network domain. Indirect interconnection at one layer refers to the interconnection between two network domains with one or more  intermediate network domain(s) acting as transit networks. The intermediate network domain(s) provide(s) transit functionality to the two other network domains. Different interconnection modes may be used for carrying service layer signalling and media traffic.


=== Charging ===
Offline charging is applied to users who pay for their services periodically (e.g., at the end of the month). Online charging, also known as credit-based charging, is used for prepaid services, or real-time credit control of postpaid services. Both may be applied to the same session.
Charging function addresses are addresses distributed to each IMS entities and provide a common location for each entity to send charging information. charging data function (CDF) addresses are used for offline billing and Online Charging Function (OCF) for online billing.

Offline Charging : All the SIP network entities (P-CSCF, I-CSCF, S-CSCF, BGCF, MRFC, MGCF, AS) involved in the session use the Diameter Rf interface to send accounting information to a CDF  located in the same domain. The CDF will collect all this information, and build a call detail record (CDR), which is sent to the billing system of the domain.Each session carries an IMS Charging Identifier (ICID) as a unique identifier generated by the first IMS entity involved in a SIP transaction and used for the correlation with CDRs. Inter Operator Identifier (IOI) is a globally unique identifier shared between sending and receiving networks. Each domain has its own charging network. Billing systems in different domains will also exchange information, so that roaming charges can be applied.
Online charging : The S-CSCF talks to a IMS gateway function (IMS-GWF) which looks like a regular SIP application server. The IMS-GWF can signal the S-CSCF to terminate the session when the user runs out of credits during a session. The AS and MRFC use the Diameter Ro interface towards an OCF.
When immediate event charging (IEC) is used, a number of credit units is immediately deducted from the user's account by the ECF and the MRFC or AS is then authorized to provide the service. The service is not authorized when not enough credit units are available.
When event charging with unit reservation (ECUR) is used, the ECF (event charging function) first reserves a number of credit units in the user's account and then authorizes the MRFC or the AS. After the service is over, the number of spent credit units is reported and deducted from the account; the reserved credit units are then cleared.


=== IMS-based PES architecture ===
IMS-based PES (PSTN Emulation System) provides IP networks services to analog devices. IMS-based PES allows non-IMS devices to appear to IMS as normal SIP users. Analog terminal using standard analog interfaces can connect to IMS-based PES in two ways:

Via A-MGW (Access Media Gateway) that is linked and controlled by AGCF. AGCF is placed within the Operators network and controls multiple A-MGW. A-MGW and AGCF communicate using H.248.1 (Megaco) over the P1 reference point. POTS phone connect to A-MGW over the z interface. The signalling is converted to H.248 in the A-MGW and passed to AGCF. AGCF interprets the H.248 signal and other inputs from the A-MGW to format H.248 messages into appropriate SIP messages. AGCF presents itself as P-CSCF to the S-CSCF and passes generated SIP messages to S-CSCF or to IP border via IBCF (Interconnection Border Control Function). Service presented to S-CSCF in SIP messages trigger PES AS. AGCF has also certain service independent logic, for example on receipt of off-hook event from A-MGW, the AGCF requests the A-MGW to play dial tone.
Via VGW (VoIP-Gateway) or SIP Gateway/Adapter on customer premises. POTS phones via VOIP Gateway connect to P-CSCF  directly. Operators mostly use session border controllers between VoIP gateways and P-CSCFs for security and to hide network topology. VoIP gateway link to IMS using SIP over Gm reference point. The conversion from POTS service over the z interface to SIP occurs in the customer premises VoIP gateway. POTS signaling is converted to SIP and passed on to P-CSCF. VGW acts as SIP user agent and appears to P-CSCF as SIP terminal.
Both A-MGW and VGW are unaware of the services. They only relay call control signalling to and from the PSTN terminal. Session control and handling is done by IMS components.


=== Interfaces description ===


== Session handling ==
One of the most important features of IMS, that of allowing for a SIP application to be dynamically and differentially (based on the user's profile) triggered, is implemented as a filter-and-redirect signalling mechanism in the S-CSCF.
The S-CSCF might apply filter criteria to determine the need to forward SIP requests to AS. It is important to note that services for the originating party will be applied in the originating network, while the services for the terminating party will be applied in the terminating network, all in the respective S-CSCFs.


=== Initial filter criteria ===
An initial filter criteria (iFC) is an XML-based format used for describing control logic. iFCs represent a provisioned subscription of a user to an application. They are stored in the HSS as part of the IMS Subscription Profile and are downloaded to the S-CSCF upon user registration (for registered users) or on processing demand (for services, acting as unregistered users). iFCs are valid throughout the registration lifetime or until the User Profile is changed.
The iFC is composed of:

Priority - determines the order of checking the trigger.
Trigger point - logical condition(s) which is verified against initial dialog creating SIP requests or stand-alone SIP requests.
Application server URI - specifies the application server to be forwarded to when the trigger point matches.
There are two types of iFCs:

Shared - When provisioning, only a reference number (the shared iFC number) is assigned to the subscriber. During registration, only the number is sent to the CSCF, not the entire XML description. The complete XML will have previously been stored on the CSCF.
Non-shared - when provisioning, the entire XML description of the iFC is assigned to the subscriber. During registration, the entire XML description is sent to the CSCF.


== Security aspects of early IMS and non-3GPP systems ==
It is envisaged that security defined in TS 33.203 may not be available for a while especially because of the lack of USIM/ISIM interfaces and prevalence of devices that support IPv4. For this situation, to provide some protection against the most significant threats, 3GPP defines some security mechanisms, which are informally known as "early IMS security," in TR33.978. This mechanism relies on the authentication performed during the network attachment procedures, which binds between the user's profile and its IP address. This mechanism is also weak because the signaling is not protected on the user–network interface.
CableLabs in PacketCable 2.0, which adopted also the IMS architecture but has no USIM/ISIM capabilities in their terminals, published deltas to the 3GPP specifications where the Digest-MD5 is a valid authentication option. Later on, TISPAN also did a similar effort given their fixed networks scopes, although the procedures are different. To compensate for the lack of IPsec capabilities, TLS has been added as an option for securing the Gm interface. Later 3GPP Releases have included the Digest-MD5 method, towards a Common-IMS platform, yet in its own and again different approach. Although all 3 variants of Digest-MD5 authentication have the same functionality and are the same from the IMS terminal's perspective, the implementations on the Cx interface between the S-CSCF and the HSS are different.


== See also ==
4G
Generic Access Network
Image share
OMA Instant Messaging and Presence Service
IP connectivity access network
Mobile broadband
Mobile VoIP
Peer-to-peer video sharing
Service capability interaction manager
System Architecture Evolution
SIMPLE
SIP extensions for the IP multimedia subsystem
Text over IP
Ultra Mobile Broadband
Video share
Voice call continuity


== References ==


== Further reading ==
Camarillo, Gonzalo; García-Martín, Miguel A. (2007). The 3G IP multimedia subsystem (IMS) : Merging the Internet and the Cellular Worlds (2 ed.). Chichester [u.a.]: Wiley. ISBN 978-0-470-01818-7.
Poikselkä, Miikka (2007). The IMS : IP multimedia concepts and services (2 ed.). Chichester [u.a.]: Wiley. ISBN 978-0-470-01906-1.
Syed A. Ahson, Mohammed Ilyas, ed. (2009). IP multimedia subsystem (IMS) handbook. Boca Raton: CRC Press. ISBN 978-1-4200-6459-9.
Wuthnow, Mark; Stafford, Matthew; Shih, Jerry (2010). IMS : A New Model for Blending Applications. Boca Raton: CRC Press. ISBN 978-1-4200-9285-1.


== External links ==
A decent IMS tutorial
IMS Call Flows