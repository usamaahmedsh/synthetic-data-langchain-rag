Complete-linkage clustering is one of several methods of agglomerative hierarchical clustering. At the beginning of the process, each element is in a cluster of its own. The clusters are then sequentially combined into larger clusters until all elements end up being in the same cluster. The method is also known as farthest neighbour clustering. The result of the clustering can be visualized as a dendrogram, which shows the sequence of cluster fusion and the distance at which each fusion took place.


== Clustering procedure ==
At each step, the two clusters separated by the shortest distance are combined. The definition of 'shortest distance' is what differentiates between the different agglomerative clustering methods. In complete-linkage clustering, the link between two clusters contains all element pairs, and the distance between clusters equals the distance between those two elements (one in each cluster) that are farthest away from each other. The shortest of these links that remains at any step causes the fusion of the two clusters whose elements are involved. 
Mathematically, the complete linkage function — the distance 
  
    
      
        D
        (
        X
        ,
        Y
        )
      
    
    {\displaystyle D(X,Y)}
  
 between clusters 
  
    
      
        X
      
    
    {\displaystyle X}
  
 and 
  
    
      
        Y
      
    
    {\displaystyle Y}
  
 — is described by the following expression :

  
    
      
        D
        (
        X
        ,
        Y
        )
        =
        
          max
          
            x
            ∈
            X
            ,
            y
            ∈
            Y
          
        
        d
        (
        x
        ,
        y
        )
      
    
    {\displaystyle D(X,Y)=\max _{x\in X,y\in Y}d(x,y)}
  

where

  
    
      
        d
        (
        x
        ,
        y
        )
      
    
    {\displaystyle d(x,y)}
  
 is the distance between elements 
  
    
      
        x
        ∈
        X
      
    
    {\displaystyle x\in X}
  
 and 
  
    
      
        y
        ∈
        Y
      
    
    {\displaystyle y\in Y}
  
 ;

  
    
      
        X
      
    
    {\displaystyle X}
  
 and 
  
    
      
        Y
      
    
    {\displaystyle Y}
  
 are two sets of elements (clusters).


== Algorithms ==


=== Naive scheme ===
The following algorithm is an agglomerative scheme that erases rows and columns in a proximity matrix as old clusters are merged into new ones. The 
  
    
      
        N
        ×
        N
      
    
    {\displaystyle N\times N}
  
 proximity matrix D contains all distances d(i,j). The clusterings are assigned sequence numbers 0,1,......, (n − 1) and L(k) is the level of the kth clustering. A cluster with sequence number m is denoted (m) and the proximity between clusters (r) and (s) is denoted d[(r),(s)].
The complete linkage clustering algorithm consists of the following steps:

Begin with the disjoint clustering having level  
  
    
      
        L
        (
        0
        )
        =
        0
      
    
    {\displaystyle L(0)=0}
  
 and sequence number 
  
    
      
        m
        =
        0
      
    
    {\displaystyle m=0}
  
.
Find the most similar pair of clusters in the current clustering, say pair 
  
    
      
        (
        r
        )
        ,
        (
        s
        )
      
    
    {\displaystyle (r),(s)}
  
, according to 
  
    
      
        d
        [
        (
        r
        )
        ,
        (
        s
        )
        ]
        =
        max
        d
        [
        (
        i
        )
        ,
        (
        j
        )
        ]
      
    
    {\displaystyle d[(r),(s)]=\max d[(i),(j)]}
  
where the maximum is over all pairs of clusters in the current clustering.
Increment the sequence number: 
  
    
      
        m
        =
        m
        +
        1
      
    
    {\displaystyle m=m+1}
  
. Merge clusters 
  
    
      
        (
        r
        )
      
    
    {\displaystyle (r)}
  
 and 
  
    
      
        (
        s
        )
      
    
    {\displaystyle (s)}
  
 into a single cluster to form the next clustering 
  
    
      
        m
      
    
    {\displaystyle m}
  
. Set the level of this clustering to 
  
    
      
        L
        (
        m
        )
        =
        d
        [
        (
        r
        )
        ,
        (
        s
        )
        ]
      
    
    {\displaystyle L(m)=d[(r),(s)]}
  

Update the proximity matrix, 
  
    
      
        D
      
    
    {\displaystyle D}
  
, by deleting the rows and columns corresponding to clusters 
  
    
      
        (
        r
        )
      
    
    {\displaystyle (r)}
  
 and 
  
    
      
        (
        s
        )
      
    
    {\displaystyle (s)}
  
 and adding a row and column corresponding to the newly formed cluster. The proximity between the new cluster, denoted 
  
    
      
        (
        r
        ,
        s
        )
      
    
    {\displaystyle (r,s)}
  
, and an old cluster 
  
    
      
        (
        k
        )
      
    
    {\displaystyle (k)}
  
 is defined as 
  
    
      
        d
        [
        (
        r
        ,
        s
        )
        ,
        (
        k
        )
        ]
        =
        max
        {
        d
        [
        (
        k
        )
        ,
        (
        r
        )
        ]
        ,
        d
        [
        (
        k
        )
        ,
        (
        s
        )
        ]
        }
      
    
    {\displaystyle d[(r,s),(k)]=\max\{d[(k),(r)],d[(k),(s)]\}}
  
.
If all objects are in one cluster, stop. Else, go to step 2.


=== Optimally efficient scheme ===
The algorithm explained above is easy to understand but of complexity 
  
    
      
        O
        (
        
          n
          
            3
          
        
        )
      
    
    {\displaystyle O(n^{3})}
  
. In May 1976, D. Defays proposed an optimally efficient algorithm of only complexity 
  
    
      
        O
        (
        
          n
          
            2
          
        
        )
      
    
    {\displaystyle O(n^{2})}
  
 known as CLINK (published 1977) inspired by the similar algorithm SLINK for single-linkage clustering.


== Working example ==
The working example is based on a JC69 genetic distance matrix computed from the 5S ribosomal RNA sequence alignment of five bacteria: Bacillus subtilis (
  
    
      
        a
      
    
    {\displaystyle a}
  
), Bacillus stearothermophilus (
  
    
      
        b
      
    
    {\displaystyle b}
  
), Lactobacillus viridescens (
  
    
      
        c
      
    
    {\displaystyle c}
  
), Acholeplasma modicum (
  
    
      
        d
      
    
    {\displaystyle d}
  
), and Micrococcus luteus (
  
    
      
        e
      
    
    {\displaystyle e}
  
).


=== First step ===
First clustering
Let us assume that we have five elements 
  
    
      
        (
        a
        ,
        b
        ,
        c
        ,
        d
        ,
        e
        )
      
    
    {\displaystyle (a,b,c,d,e)}
  
 and the following matrix 
  
    
      
        
          D
          
            1
          
        
      
    
    {\displaystyle D_{1}}
  
 of pairwise distances between them:

In this example, 
  
    
      
        
          D
          
            1
          
        
        (
        a
        ,
        b
        )
        =
        17
      
    
    {\displaystyle D_{1}(a,b)=17}
  
 is the smallest value of 
  
    
      
        
          D
          
            1
          
        
      
    
    {\displaystyle D_{1}}
  
, so we join elements 
  
    
      
        a
      
    
    {\displaystyle a}
  
 and 
  
    
      
        b
      
    
    {\displaystyle b}
  
.

First branch length estimation
Let 
  
    
      
        u
      
    
    {\displaystyle u}
  
 denote the node to which 
  
    
      
        a
      
    
    {\displaystyle a}
  
 and 
  
    
      
        b
      
    
    {\displaystyle b}
  
 are now connected. Setting  
  
    
      
        δ
        (
        a
        ,
        u
        )
        =
        δ
        (
        b
        ,
        u
        )
        =
        
          D
          
            1
          
        
        (
        a
        ,
        b
        )
        
          /
        
        2
      
    
    {\displaystyle \delta (a,u)=\delta (b,u)=D_{1}(a,b)/2}
  
  ensures that elements 
  
    
      
        a
      
    
    {\displaystyle a}
  
 and 
  
    
      
        b
      
    
    {\displaystyle b}
  
 are equidistant from 
  
    
      
        u
      
    
    {\displaystyle u}
  
. This corresponds to the expectation of the ultrametricity hypothesis.
The branches joining 
  
    
      
        a
      
    
    {\displaystyle a}
  
 and 
  
    
      
        b
      
    
    {\displaystyle b}
  
 to 
  
    
      
        u
      
    
    {\displaystyle u}
  
 then have lengths  
  
    
      
        δ
        (
        a
        ,
        u
        )
        =
        δ
        (
        b
        ,
        u
        )
        =
        17
        
          /
        
        2
        =
        8.5
      
    
    {\displaystyle \delta (a,u)=\delta (b,u)=17/2=8.5}
  
 (see the final dendrogram)

First distance matrix update
We then proceed to update the initial proximity matrix 
  
    
      
        
          D
          
            1
          
        
      
    
    {\displaystyle D_{1}}
  
 into a new proximity matrix 
  
    
      
        
          D
          
            2
          
        
      
    
    {\displaystyle D_{2}}
  
 (see below), reduced in size by one row and one column because of the clustering of 
  
    
      
        a
      
    
    {\displaystyle a}
  
 with 
  
    
      
        b
      
    
    {\displaystyle b}
  
.
Bold values in 
  
    
      
        
          D
          
            2
          
        
      
    
    {\displaystyle D_{2}}
  
 correspond to the new distances, calculated by retaining the maximum distance between each element of the first cluster 
  
    
      
        (
        a
        ,
        b
        )
      
    
    {\displaystyle (a,b)}
  
 and each of the remaining elements:

  
    
      
        
          D
          
            2
          
        
        (
        (
        a
        ,
        b
        )
        ,
        c
        )
        =
        m
        a
        x
        (
        
          D
          
            1
          
        
        (
        a
        ,
        c
        )
        ,
        
          D
          
            1
          
        
        (
        b
        ,
        c
        )
        )
        =
        m
        a
        x
        (
        21
        ,
        30
        )
        =
        30
      
    
    {\displaystyle D_{2}((a,b),c)=max(D_{1}(a,c),D_{1}(b,c))=max(21,30)=30}
  

  
    
      
        
          D
          
            2
          
        
        (
        (
        a
        ,
        b
        )
        ,
        d
        )
        =
        m
        a
        x
        (
        
          D
          
            1
          
        
        (
        a
        ,
        d
        )
        ,
        
          D
          
            1
          
        
        (
        b
        ,
        d
        )
        )
        =
        m
        a
        x
        (
        31
        ,
        34
        )
        =
        34
      
    
    {\displaystyle D_{2}((a,b),d)=max(D_{1}(a,d),D_{1}(b,d))=max(31,34)=34}
  

  
    
      
        
          D
          
            2
          
        
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        =
        m
        a
        x
        (
        
          D
          
            1
          
        
        (
        a
        ,
        e
        )
        ,
        
          D
          
            1
          
        
        (
        b
        ,
        e
        )
        )
        =
        m
        a
        x
        (
        23
        ,
        21
        )
        =
        23
      
    
    {\displaystyle D_{2}((a,b),e)=max(D_{1}(a,e),D_{1}(b,e))=max(23,21)=23}
  

Italicized values in 
  
    
      
        
          D
          
            2
          
        
      
    
    {\displaystyle D_{2}}
  
 are not affected by the matrix update as they correspond to distances between elements not involved in the first cluster.


=== Second step ===
Second clustering
We now reiterate the three previous steps, starting from the new distance matrix 
  
    
      
        
          D
          
            2
          
        
      
    
    {\displaystyle D_{2}}
  
 :

Here, 
  
    
      
        
          D
          
            2
          
        
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        =
        23
      
    
    {\displaystyle D_{2}((a,b),e)=23}
  
  is the lowest value of 
  
    
      
        
          D
          
            2
          
        
      
    
    {\displaystyle D_{2}}
  
, so we join cluster 
  
    
      
        (
        a
        ,
        b
        )
      
    
    {\displaystyle (a,b)}
  
 with element 
  
    
      
        e
      
    
    {\displaystyle e}
  
.

Second branch length estimation
Let 
  
    
      
        v
      
    
    {\displaystyle v}
  
 denote the node to which 
  
    
      
        (
        a
        ,
        b
        )
      
    
    {\displaystyle (a,b)}
  
 and 
  
    
      
        e
      
    
    {\displaystyle e}
  
 are now connected. Because of the ultrametricity constraint, the branches joining 
  
    
      
        a
      
    
    {\displaystyle a}
  
 or 
  
    
      
        b
      
    
    {\displaystyle b}
  
 to 
  
    
      
        v
      
    
    {\displaystyle v}
  
, and 
  
    
      
        e
      
    
    {\displaystyle e}
  
 to 
  
    
      
        v
      
    
    {\displaystyle v}
  
, are equal and have the following total length:

  
    
      
        δ
        (
        a
        ,
        v
        )
        =
        δ
        (
        b
        ,
        v
        )
        =
        δ
        (
        e
        ,
        v
        )
        =
        23
        
          /
        
        2
        =
        11.5
      
    
    {\displaystyle \delta (a,v)=\delta (b,v)=\delta (e,v)=23/2=11.5}
  

We deduce the missing branch length:

  
    
      
        δ
        (
        u
        ,
        v
        )
        =
        δ
        (
        e
        ,
        v
        )
        −
        δ
        (
        a
        ,
        u
        )
        =
        δ
        (
        e
        ,
        v
        )
        −
        δ
        (
        b
        ,
        u
        )
        =
        11.5
        −
        8.5
        =
        3
      
    
    {\displaystyle \delta (u,v)=\delta (e,v)-\delta (a,u)=\delta (e,v)-\delta (b,u)=11.5-8.5=3}
  
 (see the final dendrogram)

Second distance matrix update
We then proceed to update the 
  
    
      
        
          D
          
            2
          
        
      
    
    {\displaystyle D_{2}}
  
 matrix into a new distance matrix 
  
    
      
        
          D
          
            3
          
        
      
    
    {\displaystyle D_{3}}
  
 (see below), reduced in size by one row and one column because of the clustering of 
  
    
      
        (
        a
        ,
        b
        )
      
    
    {\displaystyle (a,b)}
  
 with 
  
    
      
        e
      
    
    {\displaystyle e}
  
 :

  
    
      
        
          D
          
            3
          
        
        (
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        ,
        c
        )
        =
        m
        a
        x
        (
        
          D
          
            2
          
        
        (
        (
        a
        ,
        b
        )
        ,
        c
        )
        ,
        
          D
          
            2
          
        
        (
        e
        ,
        c
        )
        )
        =
        m
        a
        x
        (
        30
        ,
        39
        )
        =
        39
      
    
    {\displaystyle D_{3}(((a,b),e),c)=max(D_{2}((a,b),c),D_{2}(e,c))=max(30,39)=39}
  

  
    
      
        
          D
          
            3
          
        
        (
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        ,
        d
        )
        =
        m
        a
        x
        (
        
          D
          
            2
          
        
        (
        (
        a
        ,
        b
        )
        ,
        d
        )
        ,
        
          D
          
            2
          
        
        (
        e
        ,
        d
        )
        )
        =
        m
        a
        x
        (
        34
        ,
        43
        )
        =
        43
      
    
    {\displaystyle D_{3}(((a,b),e),d)=max(D_{2}((a,b),d),D_{2}(e,d))=max(34,43)=43}
  


=== Third step ===
Third clustering
We again reiterate the three previous steps, starting from the updated distance matrix 
  
    
      
        
          D
          
            3
          
        
      
    
    {\displaystyle D_{3}}
  
.

Here, 
  
    
      
        
          D
          
            3
          
        
        (
        c
        ,
        d
        )
        =
        28
      
    
    {\displaystyle D_{3}(c,d)=28}
  
 is the smallest value of 
  
    
      
        
          D
          
            3
          
        
      
    
    {\displaystyle D_{3}}
  
, so we join elements 
  
    
      
        c
      
    
    {\displaystyle c}
  
 and 
  
    
      
        d
      
    
    {\displaystyle d}
  
.

Third branch length estimation
Let 
  
    
      
        w
      
    
    {\displaystyle w}
  
 denote the node to which 
  
    
      
        c
      
    
    {\displaystyle c}
  
 and 
  
    
      
        d
      
    
    {\displaystyle d}
  
 are now connected.
The branches joining 
  
    
      
        c
      
    
    {\displaystyle c}
  
 and 
  
    
      
        d
      
    
    {\displaystyle d}
  
 to 
  
    
      
        w
      
    
    {\displaystyle w}
  
 then have lengths  
  
    
      
        δ
        (
        c
        ,
        w
        )
        =
        δ
        (
        d
        ,
        w
        )
        =
        28
        
          /
        
        2
        =
        14
      
    
    {\displaystyle \delta (c,w)=\delta (d,w)=28/2=14}
  
 (see the final dendrogram)

Third distance matrix update
There is a single entry to update:

  
    
      
        
          D
          
            4
          
        
        (
        (
        c
        ,
        d
        )
        ,
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        )
        =
        m
        a
        x
        (
        
          D
          
            3
          
        
        (
        c
        ,
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        )
        ,
        
          D
          
            3
          
        
        (
        d
        ,
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        )
        )
        =
        m
        a
        x
        (
        39
        ,
        43
        )
        =
        43
      
    
    {\displaystyle D_{4}((c,d),((a,b),e))=max(D_{3}(c,((a,b),e)),D_{3}(d,((a,b),e)))=max(39,43)=43}
  


=== Final step ===
The final 
  
    
      
        
          D
          
            4
          
        
      
    
    {\displaystyle D_{4}}
  
 matrix is:

So we join clusters 
  
    
      
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
      
    
    {\displaystyle ((a,b),e)}
  
 and 
  
    
      
        (
        c
        ,
        d
        )
      
    
    {\displaystyle (c,d)}
  
.
Let 
  
    
      
        r
      
    
    {\displaystyle r}
  
 denote the (root) node to which 
  
    
      
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
      
    
    {\displaystyle ((a,b),e)}
  
 and 
  
    
      
        (
        c
        ,
        d
        )
      
    
    {\displaystyle (c,d)}
  
 are now connected.
The branches joining 
  
    
      
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
      
    
    {\displaystyle ((a,b),e)}
  
 and 
  
    
      
        (
        c
        ,
        d
        )
      
    
    {\displaystyle (c,d)}
  
 to 
  
    
      
        r
      
    
    {\displaystyle r}
  
 then have lengths:

  
    
      
        δ
        (
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        ,
        r
        )
        =
        δ
        (
        (
        c
        ,
        d
        )
        ,
        r
        )
        =
        43
        
          /
        
        2
        =
        21.5
      
    
    {\displaystyle \delta (((a,b),e),r)=\delta ((c,d),r)=43/2=21.5}
  

We deduce the two remaining branch lengths:

  
    
      
        δ
        (
        v
        ,
        r
        )
        =
        δ
        (
        (
        (
        a
        ,
        b
        )
        ,
        e
        )
        ,
        r
        )
        −
        δ
        (
        e
        ,
        v
        )
        =
        21.5
        −
        11.5
        =
        10
      
    
    {\displaystyle \delta (v,r)=\delta (((a,b),e),r)-\delta (e,v)=21.5-11.5=10}
  

  
    
      
        δ
        (
        w
        ,
        r
        )
        =
        δ
        (
        (
        c
        ,
        d
        )
        ,
        r
        )
        −
        δ
        (
        c
        ,
        w
        )
        =
        21.5
        −
        14
        =
        7.5
      
    
    {\displaystyle \delta (w,r)=\delta ((c,d),r)-\delta (c,w)=21.5-14=7.5}
  


=== The complete-linkage dendrogram ===

The dendrogram is now complete. It is ultrametric because all tips (
  
    
      
        a
      
    
    {\displaystyle a}
  
 to 
  
    
      
        e
      
    
    {\displaystyle e}
  
) are equidistant from 
  
    
      
        r
      
    
    {\displaystyle r}
  
 :

  
    
      
        δ
        (
        a
        ,
        r
        )
        =
        δ
        (
        b
        ,
        r
        )
        =
        δ
        (
        e
        ,
        r
        )
        =
        δ
        (
        c
        ,
        r
        )
        =
        δ
        (
        d
        ,
        r
        )
        =
        21.5
      
    
    {\displaystyle \delta (a,r)=\delta (b,r)=\delta (e,r)=\delta (c,r)=\delta (d,r)=21.5}
  

The dendrogram is therefore rooted by 
  
    
      
        r
      
    
    {\displaystyle r}
  
, its deepest node.


== Comparison with other linkages ==
Alternative linkage schemes include single linkage clustering and average linkage clustering - implementing a different linkage in the naive algorithm is simply a matter of using a different formula to calculate inter-cluster distances in the initial computation of the proximity matrix and in step 4 of the above algorithm. An optimally efficient algorithm is however not available for arbitrary linkages. The formula that should be adjusted has been highlighted using bold text.
Complete linkage clustering avoids a drawback of the alternative single linkage method - the so-called chaining phenomenon, where clusters formed via single linkage clustering may be forced together due to single elements being close to each other, even though many of the elements in each cluster may be very distant to each other. Complete linkage tends to find compact clusters of approximately equal diameters.


== See also ==
Cluster analysis
Hierarchical clustering
Molecular clock
Neighbor-joining
Single-linkage clustering
UPGMA
WPGMA


== References ==


== Further reading ==
Späth H (1980). Cluster Analysis Algorithms. Chichester: Ellis Horwood.