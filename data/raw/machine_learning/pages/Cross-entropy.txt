In information theory, the cross-entropy between two probability distributions 
  
    
      
        p
      
    
    {\displaystyle p}
  
 and 
  
    
      
        q
      
    
    {\displaystyle q}
  
, over the same underlying set of events, measures the average number of bits needed to identify an event drawn from the set when the coding scheme used for the set is optimized for an estimated probability distribution 
  
    
      
        q
      
    
    {\displaystyle q}
  
, rather than the true distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
.


== Definition ==
The cross-entropy of the distribution 
  
    
      
        q
      
    
    {\displaystyle q}
  
  relative to a distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
 over a given set is defined as follows:

  
    
      
        H
        (
        p
        ,
        q
        )
        =
        −
        
          E
          
            p
          
        
        ⁡
        [
        log
        ⁡
        q
        ]
        ,
      
    
    {\displaystyle H(p,q)=-\operatorname {E} _{p}[\log q],}
  

where 
  
    
      
        
          E
          
            p
          
        
        ⁡
        [
        ⋅
        ]
      
    
    {\displaystyle \operatorname {E} _{p}[\cdot ]}
  
 is the expected value operator with respect to the distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
.
The definition may be formulated using the Kullback–Leibler divergence 
  
    
      
        
          D
          
            
              K
              L
            
          
        
        (
        p
        ∥
        q
        )
      
    
    {\displaystyle D_{\mathrm {KL} }(p\parallel q)}
  
, divergence of 
  
    
      
        p
      
    
    {\displaystyle p}
  
 from 
  
    
      
        q
      
    
    {\displaystyle q}
  
 (also known as the relative entropy of 
  
    
      
        p
      
    
    {\displaystyle p}
  
 with respect to 
  
    
      
        q
      
    
    {\displaystyle q}
  
).

  
    
      
        H
        (
        p
        ,
        q
        )
        =
        H
        (
        p
        )
        +
        
          D
          
            
              K
              L
            
          
        
        (
        p
        ∥
        q
        )
        ,
      
    
    {\displaystyle H(p,q)=H(p)+D_{\mathrm {KL} }(p\parallel q),}
  

where 
  
    
      
        H
        (
        p
        )
      
    
    {\displaystyle H(p)}
  
 is the entropy of 
  
    
      
        p
      
    
    {\displaystyle p}
  
.
For discrete probability distributions 
  
    
      
        p
      
    
    {\displaystyle p}
  
 and 
  
    
      
        q
      
    
    {\displaystyle q}
  
 with the same support 
  
    
      
        
          
            X
          
        
      
    
    {\displaystyle {\mathcal {X}}}
  
, this means

The situation for continuous distributions is analogous. We have to assume that 
  
    
      
        p
      
    
    {\displaystyle p}
  
 and 
  
    
      
        q
      
    
    {\displaystyle q}
  
 are absolutely continuous with respect to some reference measure 
  
    
      
        r
      
    
    {\displaystyle r}
  
 (usually 
  
    
      
        r
      
    
    {\displaystyle r}
  
 is a Lebesgue measure on a Borel σ-algebra). Let 
  
    
      
        P
      
    
    {\displaystyle P}
  
 and 
  
    
      
        Q
      
    
    {\displaystyle Q}
  
 be probability density functions of 
  
    
      
        p
      
    
    {\displaystyle p}
  
 and 
  
    
      
        q
      
    
    {\displaystyle q}
  
 with respect to 
  
    
      
        r
      
    
    {\displaystyle r}
  
. Then

  
    
      
        −
        
          ∫
          
            
              X
            
          
        
        P
        (
        x
        )
        
        log
        ⁡
        Q
        (
        x
        )
        
        
          d
        
        x
        =
        
          E
          
            p
          
        
        ⁡
        [
        −
        log
        ⁡
        Q
        ]
        ,
      
    
    {\displaystyle -\int _{\mathcal {X}}P(x)\,\log Q(x)\,\mathrm {d} x=\operatorname {E} _{p}[-\log Q],}
  

and therefore

NB: The notation 
  
    
      
        H
        (
        p
        ,
        q
        )
      
    
    {\displaystyle H(p,q)}
  
 is also used for a different concept, the joint entropy of 
  
    
      
        p
      
    
    {\displaystyle p}
  
 and 
  
    
      
        q
      
    
    {\displaystyle q}
  
.


== Motivation ==
In information theory, the Kraft–McMillan theorem establishes that any directly decodable coding scheme for coding a message to identify one value 
  
    
      
        
          x
          
            i
          
        
      
    
    {\displaystyle x_{i}}
  
 out of a set of possibilities 
  
    
      
        {
        
          x
          
            1
          
        
        ,
        …
        ,
        
          x
          
            n
          
        
        }
      
    
    {\displaystyle \{x_{1},\ldots ,x_{n}\}}
  
 can be seen as representing an implicit probability distribution 
  
    
      
        q
        (
        
          x
          
            i
          
        
        )
        =
        
          
            (
            
              
                1
                2
              
            
            )
          
          
            
              ℓ
              
                i
              
            
          
        
      
    
    {\displaystyle q(x_{i})=\left({\frac {1}{2}}\right)^{\ell _{i}}}
  
 over 
  
    
      
        {
        
          x
          
            1
          
        
        ,
        …
        ,
        
          x
          
            n
          
        
        }
      
    
    {\displaystyle \{x_{1},\ldots ,x_{n}\}}
  
, where 
  
    
      
        
          ℓ
          
            i
          
        
      
    
    {\displaystyle \ell _{i}}
  
 is the length of the code for 
  
    
      
        
          x
          
            i
          
        
      
    
    {\displaystyle x_{i}}
  
 in bits. Therefore, cross-entropy can be interpreted as the expected message-length per datum when a wrong distribution 
  
    
      
        q
      
    
    {\displaystyle q}
  
 is assumed while the data actually follows a distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
. That is why the expectation is taken over the true probability distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
 and not 
  
    
      
        q
        .
      
    
    {\displaystyle q.}
  
 Indeed the expected message-length under the true distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
 is

  
    
      
        
          
            
              
                
                  E
                  
                    p
                  
                
                ⁡
                [
                ℓ
                ]
              
              
                
                =
                −
                
                  E
                  
                    p
                  
                
                ⁡
                
                  [
                  
                    
                      
                        ln
                        ⁡
                        
                          q
                          (
                          x
                          )
                        
                      
                      
                        ln
                        ⁡
                        (
                        2
                        )
                      
                    
                  
                  ]
                
              
            
            
              
              
                
                =
                −
                
                  E
                  
                    p
                  
                
                ⁡
                
                  [
                  
                    
                      log
                      
                        2
                      
                    
                    ⁡
                    
                      q
                      (
                      x
                      )
                    
                  
                  ]
                
              
            
            
              
              
                
                =
                −
                
                  ∑
                  
                    
                      x
                      
                        i
                      
                    
                  
                
                p
                (
                
                  x
                  
                    i
                  
                
                )
                
                
                  log
                  
                    2
                  
                
                ⁡
                q
                (
                
                  x
                  
                    i
                  
                
                )
              
            
            
              
              
                
                =
                −
                
                  ∑
                  
                    x
                  
                
                p
                (
                x
                )
                
                
                  log
                  
                    2
                  
                
                ⁡
                q
                (
                x
                )
                =
                H
                (
                p
                ,
                q
                )
                .
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\operatorname {E} _{p}[\ell ]&=-\operatorname {E} _{p}\left[{\frac {\ln {q(x)}}{\ln(2)}}\right]\\[1ex]&=-\operatorname {E} _{p}\left[\log _{2}{q(x)}\right]\\[1ex]&=-\sum _{x_{i}}p(x_{i})\,\log _{2}q(x_{i})\\[1ex]&=-\sum _{x}p(x)\,\log _{2}q(x)=H(p,q).\end{aligned}}}
  


== Estimation ==
There are many situations where cross-entropy needs to be measured but the distribution of 
  
    
      
        p
      
    
    {\displaystyle p}
  
 is unknown. An example is language modeling, where a model is created based on a training set 
  
    
      
        T
      
    
    {\displaystyle T}
  
, and then its cross-entropy is measured on a test set to assess how accurate the model is in predicting the test data. In this example, 
  
    
      
        p
      
    
    {\displaystyle p}
  
 is the true distribution of words in any corpus, and 
  
    
      
        q
      
    
    {\displaystyle q}
  
 is the distribution of words as predicted by the model. Since the true distribution is unknown, cross-entropy cannot be directly calculated. In these cases, an estimate of cross-entropy is calculated using the following formula:

  
    
      
        H
        (
        T
        ,
        q
        )
        =
        −
        
          ∑
          
            i
            =
            1
          
          
            N
          
        
        
          
            1
            N
          
        
        
          log
          
            2
          
        
        ⁡
        q
        (
        
          x
          
            i
          
        
        )
      
    
    {\displaystyle H(T,q)=-\sum _{i=1}^{N}{\frac {1}{N}}\log _{2}q(x_{i})}
  

where 
  
    
      
        N
      
    
    {\displaystyle N}
  
 is the size of the test set, and 
  
    
      
        q
        (
        x
        )
      
    
    {\displaystyle q(x)}
  
 is the probability of event 
  
    
      
        x
      
    
    {\displaystyle x}
  
 estimated from the training set. In other words, 
  
    
      
        q
        (
        
          x
          
            i
          
        
        )
      
    
    {\displaystyle q(x_{i})}
  
 is the probability estimate of the model that the i-th word of the text is 
  
    
      
        
          x
          
            i
          
        
      
    
    {\displaystyle x_{i}}
  
. The sum is averaged over the 
  
    
      
        N
      
    
    {\displaystyle N}
  
 words of the test. This is a Monte Carlo estimate of the true cross-entropy, where the test set is treated as samples from 
  
    
      
        p
        (
        x
        )
      
    
    {\displaystyle p(x)}
  
.


== Relation to maximum likelihood ==
The cross entropy arises in classification problems when introducing a logarithm in the guise of the log-likelihood function.
This section concerns the estimation of the probabilities of different discrete outcomes. To this end, denote a parametrized family of distributions by 
  
    
      
        
          q
          
            θ
          
        
      
    
    {\displaystyle q_{\theta }}
  
, with 
  
    
      
        θ
      
    
    {\displaystyle \theta }
  
 subject to the optimization effort. Consider a given finite sequence of 
  
    
      
        N
      
    
    {\displaystyle N}
  
 values 
  
    
      
        
          x
          
            i
          
        
      
    
    {\displaystyle x_{i}}
  
 from a training set, obtained from conditionally independent sampling. The likelihood assigned to any considered parameter 
  
    
      
        θ
      
    
    {\displaystyle \theta }
  
 of the model is then given by the product over all probabilities 
  
    
      
        
          q
          
            θ
          
        
        (
        X
        =
        
          x
          
            i
          
        
        )
      
    
    {\displaystyle q_{\theta }(X=x_{i})}
  
.
Repeated occurrences are possible, leading to equal factors in the product. If the count of occurrences of the value equal to 
  
    
      
        x
      
    
    {\displaystyle x}
  
 is denoted by 
  
    
      
        #
        x
      
    
    {\displaystyle \#x}
  
, then the frequency of that value equals 
  
    
      
        #
        x
        
          /
        
        N
      
    
    {\displaystyle \#x/N}
  
. If 
  
    
      
        p
        (
        X
        =
        x
        )
      
    
    {\displaystyle p(X=x)}
  
 is the underlying probability distribution, for large  
  
    
      
        N
      
    
    {\displaystyle N}
  
 we expect 
  
    
      
        p
        (
        X
        =
        x
        )
        ≈
        #
        x
        
          /
        
        N
      
    
    {\displaystyle p(X=x)\approx \#x/N}
  
, by the law of large numbers.
Writing our likelihood function as the product of observations from the distribution 
  
    
      
        
          q
          
            θ
          
        
      
    
    {\displaystyle q_{\theta }}
  
:

  
    
      
        
          
            
              
                
                  
                    L
                  
                
                (
                θ
                ;
                
                  
                    x
                  
                
                )
              
              
                
                =
                
                  ∏
                  
                    i
                  
                
                
                  q
                  
                    θ
                  
                
                (
                X
                =
                
                  x
                  
                    i
                  
                
                )
                =
                
                  ∏
                  
                    x
                  
                
                
                  q
                  
                    θ
                  
                
                (
                X
                =
                x
                
                  )
                  
                    #
                    x
                  
                
              
            
            
              
              
                
                ≈
                
                  ∏
                  
                    x
                  
                
                
                  q
                  
                    θ
                  
                
                (
                X
                =
                x
                
                  )
                  
                    N
                    p
                    (
                    X
                    =
                    x
                    )
                  
                
                =
                exp
                ⁡
                log
                ⁡
                
                  [
                  
                    
                      ∏
                      
                        x
                      
                    
                    
                      q
                      
                        θ
                      
                    
                    (
                    X
                    =
                    x
                    
                      )
                      
                        N
                        p
                        (
                        X
                        =
                        x
                        )
                      
                    
                  
                  ]
                
              
            
            
              
              
                
                =
                exp
                ⁡
                
                  (
                  
                    
                      ∑
                      
                        x
                      
                    
                    N
                    ⋅
                    p
                    (
                    X
                    =
                    x
                    )
                    log
                    ⁡
                    
                      q
                      
                        θ
                      
                    
                    (
                    X
                    =
                    x
                    
                      )
                      

                      
                    
                  
                  )
                
                ,
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\mathcal {L}}(\theta ;{\mathbf {x} })&=\prod _{i}q_{\theta }(X=x_{i})=\prod _{x}q_{\theta }(X=x)^{\#x}\\&\approx \prod _{x}q_{\theta }(X=x)^{Np(X=x)}=\exp \log \left[\prod _{x}q_{\theta }(X=x)^{Np(X=x)}\right]\\&=\exp \left(\sum _{x}N\cdot p(X=x)\log q_{\theta }(X=x)^{}\right),\end{aligned}}}
  

where we have used the calculation rules for the logarithm in the final line. Notice how the exponent equals 
  
    
      
        −
        H
        (
        p
        ,
        
          q
          
            θ
          
        
        )
      
    
    {\displaystyle -H(p,q_{\theta })}
  
. Taking the logarithm of both sides gives:

  
    
      
        log
        ⁡
        
          
            L
          
        
        (
        θ
        ;
        
          
            x
          
        
        )
        =
        −
        N
        ⋅
        H
        (
        p
        ,
        
          q
          
            θ
          
        
        )
        .
      
    
    {\displaystyle \log {\mathcal {L}}(\theta ;{\mathbf {x} })=-N\cdot H(p,q_{\theta }).}
  

Since the logarithm is a monotonically increasing function, the maximizing value of  
  
    
      
        θ
      
    
    {\displaystyle \theta }
  
 is unaffected by this final step. Similarly, the maximizing value of  
  
    
      
        θ
      
    
    {\displaystyle \theta }
  
 is unaffected by the factor of 
  
    
      
        N
      
    
    {\displaystyle N}
  
. So we observe that the likelihood maximization amounts to minimization of the cross-entropy.


== Cross-entropy minimization ==

Cross-entropy minimization is frequently used in optimization and rare-event probability estimation. When comparing a distribution 
  
    
      
        q
      
    
    {\displaystyle q}
  
 against a fixed reference distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
, cross-entropy and KL divergence are identical up to an additive constant (since 
  
    
      
        p
      
    
    {\displaystyle p}
  
 is fixed): According to the Gibbs' inequality,  both take on their minimal values when 
  
    
      
        p
        =
        q
      
    
    {\displaystyle p=q}
  
, which is 
  
    
      
        0
      
    
    {\displaystyle 0}
  
 for KL divergence, and 
  
    
      
        
          H
        
        (
        p
        )
      
    
    {\displaystyle \mathrm {H} (p)}
  
 for cross-entropy. In the engineering literature, the principle of minimizing KL divergence (Kullback's "Principle of Minimum Discrimination Information") is often called the Principle of Minimum Cross-Entropy (MCE), or Minxent.
However, as discussed in the article Kullback–Leibler divergence, sometimes the distribution 
  
    
      
        q
      
    
    {\displaystyle q}
  
 is the fixed prior reference distribution, and the distribution 
  
    
      
        p
      
    
    {\displaystyle p}
  
 is optimized to be as close to 
  
    
      
        q
      
    
    {\displaystyle q}
  
 as possible, subject to some constraint. In this case the two minimizations are not equivalent. This has led to some ambiguity in the literature, with some authors attempting to resolve the inconsistency by restating cross-entropy to be 
  
    
      
        
          D
          
            
              K
              L
            
          
        
        (
        p
        ∥
        q
        )
      
    
    {\displaystyle D_{\mathrm {KL} }(p\parallel q)}
  
, rather than 
  
    
      
        H
        (
        p
        ,
        q
        )
      
    
    {\displaystyle H(p,q)}
  
. In fact, cross-entropy is another name for relative entropy; see Cover and Thomas  and Good. On the other hand, 
  
    
      
        H
        (
        p
        ,
        q
        )
      
    
    {\displaystyle H(p,q)}
  
 does not agree with the literature and can be misleading.


== Cross-entropy loss function and logistic regression ==
Cross-entropy can be used to define a loss function in machine learning and optimization. Mao, Mohri, and Zhong (2023) give an extensive analysis of the properties of the family of cross-entropy loss functions in machine learning, including theoretical learning guarantees and extensions to adversarial learning. The true probability 
  
    
      
        
          p
          
            i
          
        
      
    
    {\displaystyle p_{i}}
  
 is the true label, and the given distribution 
  
    
      
        
          q
          
            i
          
        
      
    
    {\displaystyle q_{i}}
  
 is the predicted value of the current model. This is also known as the log loss (or logarithmic loss or logistic loss); the terms "log loss" and "cross-entropy loss" are used interchangeably.
More specifically, consider a binary regression model which can be used to classify observations into two possible classes (often simply labelled 
  
    
      
        0
      
    
    {\displaystyle 0}
  
 and 
  
    
      
        1
      
    
    {\displaystyle 1}
  
). The output of the model for a given observation, given a vector of input features 
  
    
      
        x
      
    
    {\displaystyle x}
  
, can be interpreted as a probability, which serves as the basis for classifying the observation. In logistic regression, the probability is modeled using the logistic function 
  
    
      
        g
        (
        z
        )
        =
        1
        
          /
        
        (
        1
        +
        
          e
          
            −
            z
          
        
        )
      
    
    {\displaystyle g(z)=1/(1+e^{-z})}
  
 where 
  
    
      
        z
      
    
    {\displaystyle z}
  
 is some function of the input vector 
  
    
      
        x
      
    
    {\displaystyle x}
  
, commonly just a linear function. The probability of the output 
  
    
      
        y
        =
        1
      
    
    {\displaystyle y=1}
  
 is given by

  
    
      
        
          q
          
            y
            =
            1
          
        
        =
        
          
            
              y
              ^
            
          
        
        ≡
        g
        (
        
          w
        
        ⋅
        
          x
        
        )
        =
        
          
            1
            
              1
              +
              
                e
                
                  −
                  
                    w
                  
                  ⋅
                  
                    x
                  
                
              
            
          
        
        ,
      
    
    {\displaystyle q_{y=1}={\hat {y}}\equiv g(\mathbf {w} \cdot \mathbf {x} )={\frac {1}{1+e^{-\mathbf {w} \cdot \mathbf {x} }}},}
  

where the vector of weights 
  
    
      
        
          w
        
      
    
    {\displaystyle \mathbf {w} }
  
 is optimized through some appropriate algorithm such as gradient descent. Similarly, the complementary probability of finding the output 
  
    
      
        y
        =
        0
      
    
    {\displaystyle y=0}
  
 is simply given by

  
    
      
        
          q
          
            y
            =
            0
          
        
        =
        1
        −
        
          
            
              y
              ^
            
          
        
        .
      
    
    {\displaystyle q_{y=0}=1-{\hat {y}}.}
  

Having set up our notation, 
  
    
      
        p
        ∈
        {
        y
        ,
        1
        −
        y
        }
      
    
    {\displaystyle p\in \{y,1-y\}}
  
 and 
  
    
      
        q
        ∈
        {
        
          
            
              y
              ^
            
          
        
        ,
        1
        −
        
          
            
              y
              ^
            
          
        
        }
      
    
    {\displaystyle q\in \{{\hat {y}},1-{\hat {y}}\}}
  
, we can use cross-entropy to get a measure of dissimilarity between 
  
    
      
        p
      
    
    {\displaystyle p}
  
 and 
  
    
      
        q
      
    
    {\displaystyle q}
  
:

  
    
      
        
          
            
              
                H
                (
                p
                ,
                q
                )
              
              
                
                =
                −
                
                  ∑
                  
                    m
                  
                
                
                  p
                  
                    m
                  
                
                log
                ⁡
                
                  q
                  
                    m
                  
                
                =
                −
                y
                log
                ⁡
                
                  
                    
                      y
                      ^
                    
                  
                
                −
                (
                1
                −
                y
                )
                log
                ⁡
                (
                1
                −
                
                  
                    
                      y
                      ^
                    
                  
                
                )
                .
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}H(p,q)&=-\sum _{m}p_{m}\log q_{m}=-y\log {\hat {y}}-(1-y)\log(1-{\hat {y}}).\end{aligned}}}
  

Logistic regression typically optimizes the log loss for all the observations on which it is trained, which is the same as optimizing the average cross-entropy in the sample. Other loss functions that penalize errors differently can be also used for training, resulting in models with different final test accuracy. For example, suppose we have 
  
    
      
        N
      
    
    {\displaystyle N}
  
 samples with each sample indexed by 
  
    
      
        n
        =
        1
        ,
        …
        ,
        N
      
    
    {\displaystyle n=1,\dots ,N}
  
. The average of the loss function is then given by

  
    
      
        
          
            
              
                J
                (
                
                  w
                
                )
              
              
                
                =
                
                  
                    1
                    N
                  
                
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    N
                  
                
                H
                (
                
                  p
                  
                    i
                  
                
                ,
                
                  q
                  
                    i
                  
                
                )
              
            
            
              
              
                
                =
                −
                
                  
                    1
                    N
                  
                
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    N
                  
                
                 
                
                  [
                  
                    
                      y
                      
                        i
                      
                    
                    log
                    ⁡
                    
                      
                        
                          
                            y
                            ^
                          
                        
                      
                      
                        i
                      
                    
                    +
                    (
                    1
                    −
                    
                      y
                      
                        i
                      
                    
                    )
                    log
                    ⁡
                    (
                    1
                    −
                    
                      
                        
                          
                            y
                            ^
                          
                        
                      
                      
                        i
                      
                    
                    )
                  
                  ]
                
                ,
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}J(\mathbf {w} )&={\frac {1}{N}}\sum _{i=1}^{N}H(p_{i},q_{i})\\&=-{\frac {1}{N}}\sum _{i=1}^{N}\ \left[y_{i}\log {\hat {y}}_{i}+(1-y_{i})\log(1-{\hat {y}}_{i})\right],\end{aligned}}}
  

where 
  
    
      
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
        ≡
        g
        (
        
          w
        
        ⋅
        
          
            x
          
          
            i
          
        
        )
        =
        1
        
          /
        
        (
        1
        +
        
          e
          
            −
            
              w
            
            ⋅
            
              
                x
              
              
                i
              
            
          
        
        )
      
    
    {\displaystyle {\hat {y}}_{i}\equiv g(\mathbf {w} \cdot \mathbf {x} _{i})=1/(1+e^{-\mathbf {w} \cdot \mathbf {x} _{i}})}
  
, with 
  
    
      
        g
        (
        z
        )
      
    
    {\displaystyle g(z)}
  
 as the logistic function as before.


== Relation to linear regression ==
The gradient of the cross-entropy loss for logistic regression is equal to the gradient of the squared-error loss for linear regression (up to a constant factor). To see this, define

  
    
      
        X
        ≡
        
          
            (
            
              
                
                  1
                
                
                  
                    x
                    
                      11
                    
                  
                
                
                  …
                
                
                  
                    x
                    
                      1
                      p
                    
                  
                
              
              
                
                  1
                
                
                  
                    x
                    
                      21
                    
                  
                
                
                  ⋯
                
                
                  
                    x
                    
                      2
                      p
                    
                  
                
              
              
                
                  ⋮
                
                
                  ⋮
                
                
                
                  ⋮
                
              
              
                
                  1
                
                
                  
                    x
                    
                      N
                      1
                    
                  
                
                
                  ⋯
                
                
                  
                    x
                    
                      N
                      p
                    
                  
                
              
            
            )
          
        
        ∈
        
          
            R
          
          
            N
            ×
            (
            p
            +
            1
            )
          
        
        ,
      
    
    {\displaystyle X\equiv {\begin{pmatrix}1&x_{11}&\dots &x_{1p}\\1&x_{21}&\cdots &x_{2p}\\\vdots &\vdots &&\vdots \\1&x_{N1}&\cdots &x_{Np}\\\end{pmatrix}}\in \mathbb {R} ^{N\times (p+1)},}
  

  
    
      
        
          
            
              
                y
                
                  i
                
              
              ^
            
          
        
        =
        g
        (
        
          w
        
        ⋅
        
          X
          
            i
          
        
        )
        =
        
          
            1
            
              1
              +
              exp
              ⁡
              (
              −
              
                w
                
                  0
                
              
              −
              
                w
                
                  1
                
              
              
                x
                
                  i
                  1
                
              
              −
              ⋯
              −
              
                w
                
                  p
                
              
              
                x
                
                  i
                  p
                
              
              )
            
          
        
        ,
      
    
    {\displaystyle {\hat {y_{i}}}=g(\mathbf {w} \cdot X^{i})={\frac {1}{1+\exp(-w_{0}-w_{1}x_{i1}-\dots -w_{p}x_{ip})}},}
  

  
    
      
        L
        (
        
          w
        
        )
        ≡
        −
        
          ∑
          
            i
            =
            1
          
          
            N
          
        
        
          [
          
            
              y
              
                i
              
            
            ln
            ⁡
            
              
                
                  
                    y
                    ^
                  
                
              
              
                i
              
            
            +
            (
            1
            −
            
              y
              
                i
              
            
            )
            ln
            ⁡
            (
            1
            −
            
              
                
                  
                    y
                    ^
                  
                
              
              
                i
              
            
            )
          
          ]
        
        .
      
    
    {\displaystyle L(\mathbf {w} )\equiv -\sum _{i=1}^{N}\left[y_{i}\ln {\hat {y}}_{i}+(1-y_{i})\ln(1-{\hat {y}}_{i})\right].}
  

Then we have the result

  
    
      
        
          ∇
          
            
              w
            
          
        
        L
        (
        
          w
        
        )
        =
        
          X
          
            
              T
            
          
        
        (
        
          
            
              
                y
              
              ^
            
          
        
        −
        
          y
        
        )
        .
      
    
    {\displaystyle \nabla _{\mathbf {w} }L(\mathbf {w} )=X^{\mathsf {T}}({\hat {\mathbf {y} }}-\mathbf {y} ).}
  

Proof: For any 
  
    
      
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
      
    
    {\displaystyle {\hat {y}}_{i}}
  
 we have

  
    
      
        
          
            ∂
            
              ∂
              
                w
                
                  0
                
              
            
          
        
        ln
        ⁡
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
        =
        
          
            ∂
            
              ∂
              
                w
                
                  0
                
              
            
          
        
        ln
        ⁡
        
          
            1
            
              1
              +
              
                e
                
                  −
                  
                    w
                    
                      0
                    
                  
                  +
                  
                    k
                    
                      0
                    
                  
                
              
            
          
        
        =
        
          
            
              e
              
                −
                
                  w
                  
                    0
                  
                
                +
                
                  k
                  
                    0
                  
                
              
            
            
              1
              +
              
                e
                
                  −
                  
                    w
                    
                      0
                    
                  
                  +
                  
                    k
                    
                      0
                    
                  
                
              
            
          
        
        =
        1
        −
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
        ,
      
    
    {\displaystyle {\frac {\partial }{\partial w_{0}}}\ln {\hat {y}}_{i}={\frac {\partial }{\partial w_{0}}}\ln {\frac {1}{1+e^{-w_{0}+k_{0}}}}={\frac {e^{-w_{0}+k_{0}}}{1+e^{-w_{0}+k_{0}}}}=1-{\hat {y}}_{i},}
  

  
    
      
        
          
            ∂
            
              ∂
              
                w
                
                  0
                
              
            
          
        
        ln
        ⁡
        (
        1
        −
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
        )
        =
        
          
            ∂
            
              ∂
              
                w
                
                  0
                
              
            
          
        
        ln
        ⁡
        
          (
          
            1
            −
            
              
                1
                
                  1
                  +
                  
                    e
                    
                      −
                      
                        w
                        
                          0
                        
                      
                      +
                      
                        k
                        
                          0
                        
                      
                    
                  
                
              
            
          
          )
        
        =
        
          
            
              −
              1
            
            
              1
              +
              
                e
                
                  −
                  
                    w
                    
                      0
                    
                  
                  +
                  
                    k
                    
                      0
                    
                  
                
              
            
          
        
        =
        −
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
      
    
    {\displaystyle {\frac {\partial }{\partial w_{0}}}\ln(1-{\hat {y}}_{i})={\frac {\partial }{\partial w_{0}}}\ln \left(1-{\frac {1}{1+e^{-w_{0}+k_{0}}}}\right)={\frac {-1}{1+e^{-w_{0}+k_{0}}}}=-{\hat {y}}_{i}}
  

and thus

  
    
      
        
          
            
              
                
                  
                    
                      ∂
                      L
                    
                    
                      ∂
                      
                        w
                        
                          0
                        
                      
                    
                  
                
              
              
                
                =
                −
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    N
                  
                
                [
                
                  y
                  
                    i
                  
                
                (
                1
                −
                
                  
                    
                      
                        y
                        ^
                      
                    
                  
                  
                    i
                  
                
                )
                −
                (
                1
                −
                
                  y
                  
                    i
                  
                
                )
                
                  
                    
                      
                        y
                        ^
                      
                    
                  
                  
                    i
                  
                
                ]
                =
                −
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    N
                  
                
                [
                
                  y
                  
                    i
                  
                
                −
                
                  
                    
                      
                        y
                        ^
                      
                    
                  
                  
                    i
                  
                
                ]
                =
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    N
                  
                
                
                  X
                  
                    i
                    0
                  
                
                (
                
                  
                    
                      
                        y
                        ^
                      
                    
                  
                  
                    i
                  
                
                −
                
                  y
                  
                    i
                  
                
                )
                .
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\frac {\partial L}{\partial w_{0}}}&=-\sum _{i=1}^{N}[y_{i}(1-{\hat {y}}_{i})-(1-y_{i}){\hat {y}}_{i}]=-\sum _{i=1}^{N}[y_{i}-{\hat {y}}_{i}]=\sum _{i=1}^{N}X_{i0}({\hat {y}}_{i}-y_{i}).\end{aligned}}}
  

Similarly, for any 
  
    
      
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
      
    
    {\displaystyle {\hat {y}}_{i}}
  
 and 
  
    
      
        j
        =
        1
        ,
        …
        ,
        p
      
    
    {\displaystyle j=1,\dots ,p}
  
 we have

  
    
      
        
          
            ∂
            
              ∂
              
                w
                
                  j
                
              
            
          
        
        ln
        ⁡
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
        =
        
          
            ∂
            
              ∂
              
                w
                
                  j
                
              
            
          
        
        ln
        ⁡
        
          
            1
            
              1
              +
              
                e
                
                  −
                  
                    w
                    
                      j
                    
                  
                  
                    x
                    
                      i
                      j
                    
                  
                  +
                  
                    k
                    
                      j
                    
                  
                
              
            
          
        
        =
        
          
            
              
                x
                
                  i
                  j
                
              
              
                e
                
                  −
                  
                    w
                    
                      j
                    
                  
                  
                    x
                    
                      i
                      j
                    
                  
                  +
                  
                    k
                    
                      j
                    
                  
                
              
            
            
              1
              +
              
                e
                
                  −
                  
                    w
                    
                      j
                    
                  
                  
                    x
                    
                      i
                      j
                    
                  
                  +
                  
                    k
                    
                      j
                    
                  
                
              
            
          
        
        =
        
          x
          
            i
            j
          
        
        (
        1
        −
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
        )
        ,
      
    
    {\displaystyle {\frac {\partial }{\partial w_{j}}}\ln {\hat {y}}_{i}={\frac {\partial }{\partial w_{j}}}\ln {\frac {1}{1+e^{-w_{j}x_{ij}+k_{j}}}}={\frac {x_{ij}e^{-w_{j}x_{ij}+k_{j}}}{1+e^{-w_{j}x_{ij}+k_{j}}}}=x_{ij}(1-{\hat {y}}_{i}),}
  

  
    
      
        
          
            ∂
            
              ∂
              
                w
                
                  j
                
              
            
          
        
        ln
        ⁡
        (
        1
        −
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
        )
        =
        
          
            ∂
            
              ∂
              
                w
                
                  j
                
              
            
          
        
        ln
        ⁡
        
          [
          
            1
            −
            
              
                1
                
                  1
                  +
                  
                    e
                    
                      −
                      
                        w
                        
                          j
                        
                      
                      
                        x
                        
                          i
                          j
                        
                      
                      +
                      
                        k
                        
                          j
                        
                      
                    
                  
                
              
            
          
          ]
        
        =
        
          
            
              −
              
                x
                
                  i
                  j
                
              
            
            
              1
              +
              
                e
                
                  −
                  
                    w
                    
                      j
                    
                  
                  
                    x
                    
                      i
                      j
                    
                  
                  +
                  
                    k
                    
                      j
                    
                  
                
              
            
          
        
        =
        −
        
          x
          
            i
            j
          
        
        
          
            
              
                y
                ^
              
            
          
          
            i
          
        
      
    
    {\displaystyle {\frac {\partial }{\partial w_{j}}}\ln(1-{\hat {y}}_{i})={\frac {\partial }{\partial w_{j}}}\ln \left[1-{\frac {1}{1+e^{-w_{j}x_{ij}+k_{j}}}}\right]={\frac {-x_{ij}}{1+e^{-w_{j}x_{ij}+k_{j}}}}=-x_{ij}{\hat {y}}_{i}}
  

and thus

  
    
      
        
          
            
              
                
                  
                    
                      ∂
                      L
                    
                    
                      ∂
                      
                        w
                        
                          j
                        
                      
                    
                  
                
              
              
                
                =
                −
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    N
                  
                
                
                  x
                  
                    i
                    j
                  
                
                [
                
                  y
                  
                    i
                  
                
                (
                1
                −
                
                  
                    
                      
                        y
                        ^
                      
                    
                  
                  
                    i
                  
                
                )
                −
                (
                1
                −
                
                  y
                  
                    i
                  
                
                )
                
                  
                    
                      
                        y
                        ^
                      
                    
                  
                  
                    i
                  
                
                ]
                =
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    N
                  
                
                
                  X
                  
                    i
                    j
                  
                
                (
                
                  
                    
                      
                        y
                        ^
                      
                    
                  
                  
                    i
                  
                
                −
                
                  y
                  
                    i
                  
                
                )
                .
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\frac {\partial L}{\partial w_{j}}}&=-\sum _{i=1}^{N}x_{ij}[y_{i}(1-{\hat {y}}_{i})-(1-y_{i}){\hat {y}}_{i}]=\sum _{i=1}^{N}X_{ij}({\hat {y}}_{i}-y_{i}).\end{aligned}}}
  

Put together, we obtain the desired result. Note that here we used the natural logarithm 
  
    
      
        l
        n
      
    
    {\displaystyle ln}
  
 instead of 
  
    
      
        l
        o
        g
      
    
    {\displaystyle log}
  
 (canonically 
  
    
      
        l
        o
        
          g
          
            2
          
        
      
    
    {\displaystyle log_{2}}
  
) in the loss function 
  
    
      
        L
      
    
    {\displaystyle L}
  
. This merely changes the result by a factor of 
  
    
      
        l
        o
        g
        (
        e
        )
      
    
    {\displaystyle log(e)}
  
 though. Moreover, for all 
  
    
      
        i
      
    
    {\displaystyle i}
  
 we reused 
  
    
      
        
          k
          
            0
          
        
        :=
        −
        
          ∑
          
            l
            =
            1
          
          
            p
          
        
        
          w
          
            l
          
        
        
          x
          
            i
            l
          
        
      
    
    {\displaystyle k_{0}:=-\sum _{l=1}^{p}w_{l}x_{il}}
  
 and 
  
    
      
        
          k
          
            j
          
        
        :=
        −
        
          w
          
            0
          
        
        −
        
          ∑
          
            l
            ≠
            j
          
        
        
          w
          
            l
          
        
        
          x
          
            i
            l
          
        
      
    
    {\displaystyle k_{j}:=-w_{0}-\sum _{l\neq j}w_{l}x_{il}}
  
 as constants w.r.t. each 
  
    
      
        
          w
          
            j
          
        
      
    
    {\displaystyle w_{j}}
  
.


== Amended cross-entropy ==
It may be beneficial to train an ensemble of models that have diversity, such that when they are combined, their predictive accuracy is augmented.
Assuming a simple ensemble of 
  
    
      
        K
      
    
    {\displaystyle K}
  
 classifiers is assembled via averaging the outputs, then the amended cross-entropy is given by

  
    
      
        
          e
          
            k
          
        
        =
        H
        (
        p
        ,
        
          q
          
            k
          
        
        )
        −
        
          
            λ
            K
          
        
        
          ∑
          
            j
            ≠
            k
          
        
        H
        (
        
          q
          
            j
          
        
        ,
        
          q
          
            k
          
        
        )
      
    
    {\displaystyle e^{k}=H(p,q^{k})-{\frac {\lambda }{K}}\sum _{j\neq k}H(q^{j},q^{k})}
  

where 
  
    
      
        
          e
          
            k
          
        
      
    
    {\displaystyle e^{k}}
  
 is the cost function of the 
  
    
      
        
          k
          
            t
            h
          
        
      
    
    {\displaystyle k^{th}}
  
 classifier, 
  
    
      
        
          q
          
            k
          
        
      
    
    {\displaystyle q^{k}}
  
 is the output probability of the 
  
    
      
        
          k
          
            t
            h
          
        
      
    
    {\displaystyle k^{th}}
  
 classifier, 
  
    
      
        p
      
    
    {\displaystyle p}
  
 is the true probability to be estimated, and 
  
    
      
        λ
      
    
    {\displaystyle \lambda }
  
 is a parameter between 0 and 1 that defines the 'diversity' that we would like to establish among the ensemble. When 
  
    
      
        λ
        =
        0
      
    
    {\displaystyle \lambda =0}
  
 we want each classifier to do its best regardless of the ensemble and when 
  
    
      
        λ
        =
        1
      
    
    {\displaystyle \lambda =1}
  
 we would like the classifier to be as diverse as possible.


== See also ==
Cross-entropy method
Logistic regression
Conditional entropy
Kullback–Leibler distance
Maximum-likelihood estimation
Mutual information
Perplexity


== References ==


== Further reading ==
de Boer, Kroese, D.P., Mannor, S. and Rubinstein, R.Y. (2005). A tutorial on the cross-entropy method. Annals of Operations Research 134 (1), 19–67.