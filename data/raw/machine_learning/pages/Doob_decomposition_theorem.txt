In the theory of stochastic processes in discrete time, a part of the mathematical theory of probability, the Doob decomposition theorem gives a unique decomposition of every adapted and integrable stochastic process as the sum of a martingale and a predictable process (or "drift") starting at zero. The theorem was proved by and is named for Joseph L. Doob.
The analogous theorem in the continuous-time case is the Doob–Meyer decomposition theorem.


== Statement ==
Let 
  
    
      
        (
        Ω
        ,
        
          
            F
          
        
        ,
        
          P
        
        )
      
    
    {\displaystyle (\Omega ,{\mathcal {F}},\mathbb {P} )}
  
 be a probability space, I = {0, 1, 2, ..., N} with 
  
    
      
        N
        ∈
        
          N
        
      
    
    {\displaystyle N\in \mathbb {N} }
  
 or 
  
    
      
        I
        =
        
          
            N
          
          
            0
          
        
      
    
    {\displaystyle I=\mathbb {N} _{0}}
  
 a finite or countably infinite index set, 
  
    
      
        (
        
          
            
              F
            
          
          
            n
          
        
        
          )
          
            n
            ∈
            I
          
        
      
    
    {\displaystyle ({\mathcal {F}}_{n})_{n\in I}}
  
 a filtration of 
  
    
      
        
          
            F
          
        
      
    
    {\displaystyle {\mathcal {F}}}
  
, and X = (Xn)n∈I an adapted stochastic process with E[|Xn|] < ∞ for all n ∈ I. Then there exist a martingale M = (Mn)n∈I and an integrable  predictable process A = (An)n∈I starting with  A0 = 0 such that Xn = Mn + An for every n ∈ I.
Here predictable means that An is 
  
    
      
        
          
            
              F
            
          
          
            n
            −
            1
          
        
      
    
    {\displaystyle {\mathcal {F}}_{n-1}}
  
-measurable for every n ∈ I \ {0}.
This decomposition is almost surely unique.


=== Remark ===
The theorem is valid word for word also for stochastic processes X taking values in the d-dimensional Euclidean space 
  
    
      
        
          
            R
          
          
            d
          
        
      
    
    {\displaystyle \mathbb {R} ^{d}}
  
 or the complex vector space 
  
    
      
        
          
            C
          
          
            d
          
        
      
    
    {\displaystyle \mathbb {C} ^{d}}
  
. This follows from the one-dimensional version by considering the components individually.


== Proof ==


=== Existence ===
Using conditional expectations, define the processes A and M, for every n ∈ I, explicitly by

and

where the sums for n = 0 are empty and defined as zero. Here A adds up the expected increments of X, and M adds up the surprises, i.e., the part of every Xk that is not known one time step before.
Due to these definitions, An+1 (if n + 1 ∈ I) and Mn are Fn-measurable because the process X is adapted, E[|An|] < ∞ and E[|Mn|] < ∞ because the process X is integrable, and the decomposition Xn = Mn + An is valid for every n ∈ I. The martingale property

  
    
      
        
          E
        
        [
        
          M
          
            n
          
        
        −
        
          M
          
            n
            −
            1
          
        
        
        
          |
        
        
        
          
            
              F
            
          
          
            n
            −
            1
          
        
        ]
        =
        0
      
    
    {\displaystyle \mathbb {E} [M_{n}-M_{n-1}\,|\,{\mathcal {F}}_{n-1}]=0}
  
    a.s.
also follows from the above definition (2), for every n ∈ I \ {0}.


=== Uniqueness ===
To prove uniqueness, let X = M' + A' be an additional decomposition. Then the process Y :=  M − M' = A' − A is a martingale, implying that

  
    
      
        
          E
        
        [
        
          Y
          
            n
          
        
        
        
          |
        
        
        
          
            
              F
            
          
          
            n
            −
            1
          
        
        ]
        =
        
          Y
          
            n
            −
            1
          
        
      
    
    {\displaystyle \mathbb {E} [Y_{n}\,|\,{\mathcal {F}}_{n-1}]=Y_{n-1}}
  
    a.s.,
and also predictable, implying that

  
    
      
        
          E
        
        [
        
          Y
          
            n
          
        
        
        
          |
        
        
        
          
            
              F
            
          
          
            n
            −
            1
          
        
        ]
        =
        
          Y
          
            n
          
        
      
    
    {\displaystyle \mathbb {E} [Y_{n}\,|\,{\mathcal {F}}_{n-1}]=Y_{n}}
  
    a.s.
for any n ∈ I \ {0}. Since Y0 = A'0 − A0 = 0 by the convention about the starting point of the predictable processes, this implies iteratively that Yn = 0 almost surely for all n ∈ I, hence the decomposition is almost surely unique.


== Corollary ==
A real-valued stochastic process X is a submartingale if and only if it has a Doob decomposition into a martingale M and an integrable predictable process A that is almost surely increasing. It is a supermartingale, if and only if A is almost surely decreasing.


=== Proof ===
If X is a submartingale, then

  
    
      
        
          E
        
        [
        
          X
          
            k
          
        
        
        
          |
        
        
        
          
            
              F
            
          
          
            k
            −
            1
          
        
        ]
        ≥
        
          X
          
            k
            −
            1
          
        
      
    
    {\displaystyle \mathbb {E} [X_{k}\,|\,{\mathcal {F}}_{k-1}]\geq X_{k-1}}
  
    a.s.
for all k ∈ I \ {0}, which is equivalent to saying that every term in definition (1) of A is almost surely positive, hence A is almost surely increasing. The equivalence for supermartingales is proved similarly.


== Example ==
Let X = (Xn)n∈
  
    
      
        
          
            N
          
          
            0
          
        
      
    
    {\displaystyle \mathbb {N} _{0}}
  
 be a sequence in independent, integrable, real-valued random variables. They are adapted to the filtration generated by the sequence, i.e. Fn = σ(X0, . . . , Xn)  for all 
  
    
      
        n
        ∈
        
          
            N
          
          
            0
          
        
        .
      
    
    {\displaystyle n\in \mathbb {N} _{0}.}
  
 By (1) and (2), the Doob decomposition is given by

  
    
      
        
          A
          
            n
          
        
        =
        
          ∑
          
            k
            =
            1
          
          
            n
          
        
        
          
            (
          
        
        
          E
        
        [
        
          X
          
            k
          
        
        ]
        −
        
          X
          
            k
            −
            1
          
        
        
          
            )
          
        
        ,
        
        n
        ∈
        
          
            N
          
          
            0
          
        
        ,
      
    
    {\displaystyle A_{n}=\sum _{k=1}^{n}{\bigl (}\mathbb {E} [X_{k}]-X_{k-1}{\bigr )},\quad n\in \mathbb {N} _{0},}
  

and

  
    
      
        
          M
          
            n
          
        
        =
        
          X
          
            0
          
        
        +
        
          ∑
          
            k
            =
            1
          
          
            n
          
        
        
          
            (
          
        
        
          X
          
            k
          
        
        −
        
          E
        
        [
        
          X
          
            k
          
        
        ]
        
          
            )
          
        
        ,
        
        n
        ∈
        
          
            N
          
          
            0
          
        
        .
      
    
    {\displaystyle M_{n}=X_{0}+\sum _{k=1}^{n}{\bigl (}X_{k}-\mathbb {E} [X_{k}]{\bigr )},\quad n\in \mathbb {N} _{0}.}
  

If the random variables of the original sequence X have mean zero, this simplifies to

  
    
      
        
          A
          
            n
          
        
        =
        −
        
          ∑
          
            k
            =
            0
          
          
            n
            −
            1
          
        
        
          X
          
            k
          
        
      
    
    {\displaystyle A_{n}=-\sum _{k=0}^{n-1}X_{k}}
  
    and    
  
    
      
        
          M
          
            n
          
        
        =
        
          ∑
          
            k
            =
            0
          
          
            n
          
        
        
          X
          
            k
          
        
        ,
        
        n
        ∈
        
          
            N
          
          
            0
          
        
        ,
      
    
    {\displaystyle M_{n}=\sum _{k=0}^{n}X_{k},\quad n\in \mathbb {N} _{0},}
  

hence both processes are (possibly time-inhomogeneous) random walks. If the sequence X = (Xn)n∈
  
    
      
        
          
            N
          
          
            0
          
        
      
    
    {\displaystyle \mathbb {N} _{0}}
  
 consists of symmetric random variables taking the values +1 and −1, then X is bounded, but the martingale M and the predictable process A are unbounded simple random walks (and not uniformly integrable), and Doob's optional stopping theorem might not be applicable to the martingale M unless the stopping time has a finite expectation.


== Application ==
In mathematical finance, the Doob decomposition theorem can be used to determine the largest optimal exercise time of an American option. Let X = (X0, X1, . . . , XN) denote the non-negative, discounted payoffs of an American option in a N-period financial market model, adapted to a filtration 
(F0, F1, . . . , FN), and let 
  
    
      
        
          Q
        
      
    
    {\displaystyle \mathbb {Q} }
  
g denote an equivalent martingale measure. Let U = (U0, U1, . . . , UN) denote the Snell envelope of X with respect to 
  
    
      
        
          Q
        
      
    
    {\displaystyle \mathbb {Q} }
  
. The Snell envelope is the smallest 
  
    
      
        
          Q
        
      
    
    {\displaystyle \mathbb {Q} }
  
-supermartingale dominating X and in a complete financial market it represents the minimal amount of capital necessary to hedge the American option up to maturity. Let U = M + A denote the Doob decomposition with respect to 
  
    
      
        
          Q
        
      
    
    {\displaystyle \mathbb {Q} }
  
 of the Snell envelope U into a martingale M = (M0, M1, . . . , MN) and a decreasing predictable process A = (A0, A1, . . . , AN) with A0 = 0. Then the largest stopping time to exercise the American option in an optimal way is

  
    
      
        
          τ
          
            max
          
        
        :=
        
          
            {
            
              
                
                  N
                
                
                  
                    if 
                  
                  
                    A
                    
                      N
                    
                  
                  =
                  0
                  ,
                
              
              
                
                  min
                  {
                  n
                  ∈
                  {
                  0
                  ,
                  …
                  ,
                  N
                  −
                  1
                  }
                  ∣
                  
                    A
                    
                      n
                      +
                      1
                    
                  
                  <
                  0
                  }
                
                
                  
                    if 
                  
                  
                    A
                    
                      N
                    
                  
                  <
                  0.
                
              
            
            
          
        
      
    
    {\displaystyle \tau _{\text{max}}:={\begin{cases}N&{\text{if }}A_{N}=0,\\\min\{n\in \{0,\dots ,N-1\}\mid A_{n+1}<0\}&{\text{if }}A_{N}<0.\end{cases}}}
  

Since A is predictable, the event {τmax = n} = {An = 0, An+1 < 0} is in Fn for every n ∈ {0, 1, . . . , N − 1}, hence τmax is indeed a stopping time. It gives the last moment before the discounted value of the American option will drop in expectation; up to time τmax the discounted value process U is a martingale with respect to 
  
    
      
        
          Q
        
      
    
    {\displaystyle \mathbb {Q} }
  
.


== Generalization ==
The Doob decomposition theorem can be generalized from probability spaces to σ-finite measure spaces.


== Citations ==


== References ==
Doob, Joseph L. (1953), Stochastic Processes, New York: Wiley, ISBN 978-0-471-21813-5, MR 0058896, Zbl 0053.26802 {{citation}}: ISBN / Date incompatibility (help)
Doob, Joseph L. (1990), Stochastic Processes (Wiley Classics Library ed.), New York: John Wiley & Sons, Inc., ISBN 0-471-52369-0, MR 1038526, Zbl 0696.60003
Durrett, Rick (2010), Probability: Theory and Examples, Cambridge Series in Statistical and Probabilistic Mathematics (4. ed.), Cambridge University Press, ISBN 978-0-521-76539-8, MR 2722836, Zbl 1202.60001
Föllmer, Hans; Schied, Alexander (2011), Stochastic Finance: An Introduction in Discrete Time, De Gruyter graduate (3. rev. and extend ed.), Berlin, New York: De Gruyter, ISBN 978-3-11-021804-6, MR 2779313, Zbl 1213.91006
Lamberton, Damien; Lapeyre, Bernard (2008), Introduction to Stochastic Calculus Applied to Finance, Chapman & Hall/CRC financial mathematics series (2. ed.), Boca Raton, FL: Chapman & Hall/CRC, ISBN 978-1-58488-626-6, MR 2362458, Zbl 1167.60001
Schilling, René L. (2005), Measures, Integrals and Martingales, Cambridge: Cambridge University Press, ISBN 978-0-52185-015-5, MR 2200059, Zbl 1084.28001
Williams, David (1991), Probability with Martingales, Cambridge University Press, ISBN 0-521-40605-6, MR 1155402, Zbl 0722.60001