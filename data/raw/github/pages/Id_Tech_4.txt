id Tech 4, popularly known as the Doom 3 engine, is a game engine developed by id Software and first used in the video game Doom 3. The engine was designed by John Carmack, who also created previous game engines, such as those for Doom and Quake, which are widely recognized as significant advances in the field. This OpenGL-based game engine has also been used in Quake 4, Prey, Enemy Territory: Quake Wars, Wolfenstein, and Brink. id Tech 4 is licensed under the terms of the GNU General Public License v3.0 or later, and is to date the last id Tech engine to be open-sourced.


== History ==
id Tech 4 began as an enhancement to id Tech 3. During development, it was initially just a complete rewrite of the engine's renderer, while still retaining other subsystems, such as file access, and memory management. The decision to switch from C to the C++ programming language necessitated a restructuring and rewrite of the rest of the engine; today, while id Tech 4 contains code from id Tech 3, much of it has been rewritten.
At the QuakeCon 2007, John Carmack, the lead graphics engine developer at id, said to LinuxGames:
"I mean, I won't commit to a date, but the Doom 3 stuff will be open source". And like its predecessors, John Carmack has said that id Tech 4 will be released as open-source.
At the QuakeCon 2009, Carmack said that he planned to petition ZeniMax Media to release the id Tech 4 source upon the release of Rage. As part of his keynote for QuakeCon 2011, he confirmed that the source code to Doom 3 would be out by the end of the year, after the release of Rage.
On November 16, 2011, Carmack announced on Twitter that he's writing new code for Doom 3's open source release, because "lawyers are still skittish about the patent issue around 'Carmack's reverse'". This refers to an implementation of stencil buffered shadow volume algorithms.
On November 22, 2011, Carmack released the Doom 3 source code under GNU GPL-3.0-or-later on GitHub. The source does not include any of the 'Carmack's Reverse' code. According to Carmack, minor tweaks were made to the code to avoid any infringement. Since then, several open-source projects have been released, such as dhewm3, Dante, and RBDOOM-3-BFG. In 2021 the Quake 4 game DLLs were adapted for use with the open source dhewm3 engine derived from the released Doom 3 source code (with work also started on Prey); this has since been used to port the game to AmigaOS 4.


=== Hardware ===
The original requirement of id Tech 4 was that it needed a high-end graphics processing unit (GPU) with fully programmable vertex and pixel shaders, such as the Nvidia GeForce 3 or ATI Radeon 8500, with at least 64 MB of VRAM. By E3 2002, the recommended GPU was "100% DirectX 9.0b compatible", such as the Radeon 9700 with 128 MB of VRAM. While the Radeon 9700's DirectX 9.0 features are not necessary to render the game, its advanced architecture, 256-bit memory bus, and efficiency were needed to run Doom 3 at high detail and playable speed.  The "Ultra" graphics mode included in Doom 3 would not even run on high end graphics cards in 2004, as the engine required at least 512 MB of video memory to display properly and at playable speeds.
id Tech 4 resulted in the obsolescence of DirectX 7 graphics chips such as the widespread GeForce 2 and Radeon 7200, as well as older chipsets such as RIVA TNT2 and Rage 128, and software rendering (with an integrated Intel GMA). Until the advent of id Tech 4, a powerful CPU was able to somewhat compensate for an older video card. While John Carmack initially warned gamers not to purchase the GeForce 4 MX (which casual consumers often confused with the DirectX 8 capable GeForce 4 Ti, though it was at best an improved GeForce 2), its somewhat widespread adoption compelled id Software to add it to the list of supported cards. There have been cases of enthusiasts forcing Doom 3 to run on unsupported graphics chips, such as the long obsolete Voodoo 2, but these are unable to render the per-pixel lighting and bump mapping.


== Features ==


=== Graphics ===
Id Tech 4 added several new graphical features absent in its predecessor, id Tech 3. These included normal mapping and specular highlighting. More features were added in the development of successive games.
The models used in id Tech 4 games are animated using skeletal animation. The engine can blend multiple animations together to produce a skin that moves correctly for those animations. Because this is CPU intensive, id did some work optimizing this by using Intel's Streaming SIMD Extensions (SSE).


==== Dynamic lighting ====

The primary innovation of id Tech 4 was its use of entirely dynamic per-pixel lighting and shadow volumes, whereas previously, 3D engines had relied primarily on pre-calculated per-vertex lighting or lightmaps and Gouraud shading, and shadows were either faked (such as the traveling dark spot beneath characters in id Tech 3 games) or non-existent. id Tech 4 unified lighting and shadows, something absent in prior id Tech engines. All light sources in Doom 3 are dynamic, something the companion book The Making of Doom 3 describes as "The biggest headache for the level designers". While dynamic effects had been available before (such as dynamic moving lights), this effect merely changed the brightness of the vertices of the polygon, with the pixel's colors simply being interpolated between the three vertex colors of its polygon.
This fully realtime approach used in Doom 3, combined with the use of shadow volumes permitted more realistic lighting and shadows than in the previous generation of id's engines. The method used to create the shadow volumes is the subject of a patent by Creative, which Creative granted id permission to use in the Doom 3 engine, in exchange for supporting Creative's EAX advanced sound technologies.


==== MegaTexture rendering technology ====
The original version of the id Tech 4 engine was designed for somewhat dark environments and was criticized for its perceived inability to handle extremely large daytime outdoor areas. The MegaTexture technology (a form of clipmapping) tackled this issue. By painting a single massive texture (initially 32,768×32,768 pixels, later extended to larger dimensions in subsequent versions) covering the entire polygon map and highly detailed terrain, the desired effects can be achieved. The MegaTexture can also store physical information about the terrain such as the amount of traction in certain areas or indicate what sound effect should be played when walking over specific parts of the map. i.e. walking on rock will sound different from walking on grass. The first game utilizing MegaTexture is Enemy Territory: Quake Wars, based on the Tech 4 engine. All id Tech 5 and id Tech 6 games use MegaTexture, with the exception of The Evil Within, which uses a new renderer. Brink, which uses a heavily modified version of id Tech 4, also uses virtual texturing. While the implementation is different from MegaTexture, it was inspired by it.


=== Scripting ===
id Tech 4 has a comprehensive scripting language that can be used when creating mods, and is used in Doom 3 to control monsters, weapons, and map events. This scripting language is similar to C++.
In addition to the main scripting language, idTech 4 also has another scripting language that is used for GUIs—both the menus and HUD, and also for GUIs embedded into the game world. These in-game GUIs are sufficiently powerful that you can, for example, run another game such as the original Doom within the game-world.
Despite this additional level of scripting, it is also possible to create mods using C++ to build native code.


=== Sound ===
As a result of the agreement with Creative regarding the patent on shadow volumes, the id Tech 4 engine supports OpenAL, including the Creative Technology specific EAX extensions. The work to include OpenAL support was done by Creative Technology, not by id themselves.


=== Networking ===
The engine uses a traditional client–server model. Initially it was planned to have a peer-to-peer networking model. This part of the engine works in a fundamentally similar way to the id Tech 3 equivalent; however, id Tech 4 exposes a lot more of the network protocol to mod developers.
Although Doom 3 only supports 4 players (and 8 in the Resurrection of Evil expansion pack), the id Tech 4 engine can be used with more players than this, with Quake 4 and Enemy Territory: Quake Wars both supporting significantly more players.


== Games using id Tech 4 ==

Compared to the preceding and widely used id Tech 3 (Quake III Arena engine) and id Tech 2 (Quake II engine), id Tech 4 has had less success in licensing to third parties. This is especially apparent in comparison to its closest contemporaries, Unreal Engine 2 (2002) and Unreal Engine 3 (2006) from Epic Games.  id Software was unwilling to license their newest engine before its "parent game" Doom 3 was completed. However, the unexpectedly long development time going into Doom 3 from 2002-04 meant that they could not put up competition to Epic Games's Unreal Engine 2 during that period. Many who licensed Unreal Engine 2 were thus able to make the switch to Unreal Engine 3 more easily.
While id Tech 4 had taken a new direction with its dynamic per-pixel lighting, this unconventional feature had steeper hardware requirements and was initially only useful in "spooky games" (until the MegaTexture addition), whereas an increasing number of developers preferred conventional engines that could render large outdoor areas. Also notable was id Tech 4's relative lack of downward scalability compared to competing FPS engines; id Tech 4 generally required a DirectX 8.0 compliant GPU such as a GeForce 3. The rival Source engine could still run on the older widespread DirectX 7 GPUs, albeit without the use of shaders.


=== Games using a proprietary license ===


=== Games using an open-source license ===


== See also ==

First person shooter engine
id Tech 3
id Tech 5
List of game engines


== Notes ==


== References ==


== External links ==
Official id Tech 4 licensing page at the Wayback Machine (archived October 26, 2008)
id Tech 4 reference material
CNN - Life after "Doom"
Doom 3 source code on GitHub